<!DOCTYPE html><html lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Eli | CSC 412: Compiler Construction</title><link href=/styles.css rel=stylesheet><link href=/favicon-32.png rel=icon sizes=32x32><link href=/favicon-128.png rel=icon sizes=128x128><link href=/favicon-180.png rel=icon sizes=180x180><link href=/favicon-192.png rel=icon sizes=192x192><style id=MJX-CHTML-styles>mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block;text-align:left}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}_::-webkit-full-page-media,_:future,:root mjx-container{will-change:opacity}mjx-assistive-mml{position:absolute!important;top:0;left:0;clip:rect(1px,1px,1px,1px);padding:1px 0 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;font-size-adjust:none;letter-spacing:normal;border-collapse:collapse;word-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-mi{display:inline-block;text-align:left}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em 0}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scalex(1.0000001)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:hidden;overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scalex(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaley(1.0000001);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:hidden;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-msup{display:inline-block;text-align:left}mjx-mn{display:inline-block;text-align:left}mjx-mspace{display:inline-block;text-align:left}mjx-TeXAtom{display:inline-block;text-align:left}mjx-msub{display:inline-block;text-align:left}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff) format("woff")}@font-face{font-family:MJXTEX;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-B;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff) format("woff")}@font-face{font-family:MJXTEX-I;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff) format("woff")}@font-face{font-family:MJXTEX-MI;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff) format("woff")}@font-face{font-family:MJXTEX-BI;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff) format("woff")}@font-face{font-family:MJXTEX-S1;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-S2;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-S3;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-S4;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-A;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-C;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-CB;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff) format("woff")}@font-face{font-family:MJXTEX-FR;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-FRB;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff) format("woff")}@font-face{font-family:MJXTEX-SS;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-SSB;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff) format("woff")}@font-face{font-family:MJXTEX-SSI;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff) format("woff")}@font-face{font-family:MJXTEX-SC;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-T;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-V;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff) format("woff")}@font-face{font-family:MJXTEX-VB;src:url(https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff) format("woff")}mjx-c.mjx-c1D442.TEX-I::before{padding:.704em .763em .022em 0;content:"O"}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}mjx-c.mjx-c6C::before{padding:.694em .278em 0 0;content:"l"}mjx-c.mjx-c6F::before{padding:.448em .5em .01em 0;content:"o"}mjx-c.mjx-c67::before{padding:.453em .5em .206em 0;content:"g"}mjx-c.mjx-c2061::before{padding:0;content:""}mjx-c.mjx-c222A::before{padding:.598em .667em .022em 0;content:"\222A"}mjx-c.mjx-c2229::before{padding:.598em .667em .022em 0;content:"\2229"}mjx-c.mjx-c2217::before{padding:.465em .5em 0 0;content:"\2217"}mjx-c.mjx-c1D700.TEX-I::before{padding:.452em .466em .022em 0;content:"\3B5"}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c1D434.TEX-I::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c2032::before{padding:.56em .275em 0 0;content:"\2032"}mjx-c.mjx-c1D43F.TEX-I::before{padding:.683em .681em 0 0;content:"L"}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}mjx-c.mjx-c1D453.TEX-I::before{padding:.705em .55em .205em 0;content:"f"}mjx-c.mjx-c1D456.TEX-I::before{padding:.661em .345em .011em 0;content:"i"}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c1D461.TEX-I::before{padding:.626em .361em .011em 0;content:"t"}mjx-c.mjx-c1D6FC.TEX-I::before{padding:.442em .64em .011em 0;content:"\3B1"}mjx-c.mjx-c2208::before{padding:.54em .667em .04em 0;content:"\2208"}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-c1D441.TEX-I::before{padding:.683em .888em 0 0;content:"N"}mjx-c.mjx-c1D465.TEX-I::before{padding:.442em .572em .011em 0;content:"x"}mjx-c.mjx-c27F9::before{padding:.525em 1.638em .024em 0;content:"\27F9"}mjx-c.mjx-c1D6FE.TEX-I::before{padding:.441em .543em .216em 0;content:"\3B3"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D459.TEX-I::before{padding:.694em .298em .011em 0;content:"l"}mjx-c.mjx-c1D464.TEX-I::before{padding:.443em .716em .011em 0;content:"w"}mjx-c.mjx-c2B::before{padding:.583em .778em .082em 0;content:"+"}mjx-c.mjx-c3D::before{padding:.583em .778em .082em 0;content:"="}mjx-c.mjx-c2192::before{padding:.511em 1em .011em 0;content:"\2192"}mjx-c.mjx-c1D6FD.TEX-I::before{padding:.705em .566em .194em 0;content:"\3B2"}mjx-c.mjx-c2205::before{padding:.772em .5em .078em 0;content:"\2205"}mjx-c.mjx-c2E::before{padding:.12em .278em 0 0;content:"."}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c30::before{padding:.666em .5em .022em 0;content:"0"}mjx-c.mjx-c1D44F.TEX-I::before{padding:.694em .429em .011em 0;content:"b"}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-c.mjx-c1D440.TEX-I::before{padding:.683em 1.051em 0 0;content:"M"}mjx-c.mjx-c22::before{padding:.694em .5em 0 0;content:"\22"}mjx-c.mjx-c2D::before{padding:.252em .333em 0 0;content:"-"}mjx-c.mjx-c2C::before{padding:.121em .278em .194em 0;content:","}mjx-c.mjx-c5B::before{padding:.75em .278em .25em 0;content:"["}mjx-c.mjx-c6E::before{padding:.442em .556em 0 0;content:"n"}mjx-c.mjx-c75::before{padding:.442em .556em .011em 0;content:"u"}mjx-c.mjx-c6D::before{padding:.442em .833em 0 0;content:"m"}mjx-c.mjx-c5D::before{padding:.75em .278em .25em 0;content:"]"}mjx-c.mjx-c2260::before{padding:.716em .778em .215em 0;content:"\2260"}mjx-c.mjx-c1D445.TEX-I::before{padding:.683em .759em .021em 0;content:"R"}mjx-c.mjx-c1D719.TEX-I::before{padding:.694em .596em .205em 0;content:"\3D5"}mjx-c.mjx-c2190::before{padding:.511em 1em .011em 0;content:"\2190"}mjx-c.mjx-c1D43A.TEX-I::before{padding:.705em .786em .022em 0;content:"G"}mjx-c.mjx-c1D458.TEX-I::before{padding:.694em .521em .011em 0;content:"k"}mjx-c.mjx-c3A3::before{padding:.683em .722em 0 0;content:"\3A3"}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c1D446.TEX-I::before{padding:.705em .645em .022em 0;content:"S"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c1D45E.TEX-I::before{padding:.442em .46em .194em 0;content:"q"}mjx-c.mjx-c1D462.TEX-I::before{padding:.442em .572em .011em 0;content:"u"}mjx-c.mjx-c1D450.TEX-I::before{padding:.442em .433em .011em 0;content:"c"}mjx-c.mjx-c1D454.TEX-I::before{padding:.442em .477em .205em 0;content:"g"}mjx-c.mjx-c210E.TEX-I::before{padding:.694em .576em .011em 0;content:"h"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c1D466.TEX-I::before{padding:.442em .49em .205em 0;content:"y"}mjx-c.mjx-c1D45A.TEX-I::before{padding:.442em .878em .011em 0;content:"m"}mjx-c.mjx-c3A::before{padding:.43em .278em 0 0;content:":"}mjx-c.mjx-c2115.TEX-A::before{padding:.683em .722em .02em 0;content:"N"}</style><nav><h2><a href=/ >e l i</a></h2><ul><li><a href=/blog/ >blog</a><li><a href=/projects/ >projects</a><li><a href=/notes/ >notes</a></ul></nav><article><header><h1 class=title>CSC 412: Compiler Construction</h1><p>Instructor: Dr. Xu Liu | Semester: Fall 2020<p><h3>Table of Contents</h3><ul><li><a href=#administrivia>Administrivia</a><li><a href=#overview-of-compilers>Overview of Compilers</a><li><a href=#front-end>Front-end</a><li><a href=#middle-end>Middle-end</a><li><a href=#back-end>Back-end</a><li><a href=#theoretical-stuff>Theoretical Stuff</a><li><a href=#performance-analysis>Performance Analysis</a></ul></header><h1 id=administrivia><a href=#administrivia aria-label="anchor link for administrivia">#</a> Administrivia</h1><table><thead><tr><th>Weight<th>Component<th>Additional Info<tbody><tr><td>30%<td>Midterm<td><tr><td>50%<td>Project<td>4 Projects (3 C/C++, 1 Python)<tr><td>20%<td>Assignments<td>All homework written.</table><ul><li>TA: Abhijeet Krishnan<li>No final<li>Testing done in Virtual Computing Lab (VCL).<li>Projects may be different between 412 and 512.<li>Attendance: Required via Zoom. Need to email ahead of time if will be absent.<li>We do not discuss linking or assembling specifically here.</ul><h1 id=overview-of-compilers><a href=#overview-of-compilers aria-label="anchor link for overview-of-compilers">#</a> Overview of Compilers</h1><ul><li>Compiler: Tool for analyzing and transforming high level programs into some executable form. Compilers often include optimizations to <strong>improve performance</strong> of the code.<li>Types of Compiler: Compilers are often categorized by similar properties.<ul><li>Traditional: High-level to low-level (machine code, bytecode, hardware FPGA/ASIC).<ul><li>C, C++, Rust</ul><li>Source-to-source/Transpiler: Produce source code for a different similarly high-level language from another language.<ul><li>Typescript, Moonscript.</ul><li>Just-in-Time (JIT): Compiles at runtime often doing tracing or other performance-guided-optimizations.<ul><li>Java (always uses bytecode but will JIT hot code)</ul><li>Decompiler: Low-level to high-level.<li>Cross Compiler: Generate code for a machine different than the host running the compiler.<li>Binary Recompiler: Binary/machine-code to another binary/machine-code. Often useful for introducing tracing or other instructions.</ul><li>Intermediate Representation: A low-level machine-code-like language that is architecture agnostic. Allows for easier optimizations and allows easier support for more languages and hosts.<ul><li>Examples: GIMPLE (gcc's IR), LLVM IR.</ul><li>Interpreter: Program that runs the source code directly. Or at least appears to do so; many interpreters do internal compilation. This is good because they are <em>easy</em> to write.<li>Activation Record: Stack frame.</ul><p>Compilers normally go through the following steps: (front-end) preprocessing, lexical analysis, parsing, (middle-end) semantic analysis, IR conversion, code optimization, and (back-end) code generation.<p>One of the hardest parts of compilers is (user-friendly) error propagation. All parts can produce errors and the error chain can be very deep and complex.<h2 id=three-pass-compiler><a href=#three-pass-compiler aria-label="anchor link for three-pass-compiler">##</a> Three-Pass Compiler</h2><p>Many compilers follow a three-pass system, with a front-end taking in source code and producing IR, middle-end taking in and producing IR, and back-end taking in IR and producing the final output.<p>The front-end lexes and parses the source code, producing an AST. It then does a bunch of analysis on the AST, such as type-checking. Then it produces IR. <em>This class mostly covers front-end.</em> It is normally <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D442"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>O</mi><mo stretchy=false>(</mo><mi>n</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> or <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D442"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mi class=mjx-n space=2><mjx-c class=mjx-c6C></mjx-c><mjx-c class=mjx-c6F></mjx-c><mjx-c class=mjx-c67></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c2061></mjx-c></mjx-mo><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>O</mi><mo stretchy=false>(</mo><mi>n</mi><mi>log</mi><mo data-mjx-texclass=NONE>⁡</mo><mo stretchy=false>(</mo><mi>n</mi><mo stretchy=false>)</mo><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container><p>The middle-end optimizes the IR a bunch. This is normally NPC (NP-Complete). <em>This class does not touch the middle-end.</em><p>The back-end produces machine-code (or other output formats) from the IR. This is normally NPC (NP-Complete) because of register allocation. <em>This class does some back-end.</em><h1 id=front-end><a href=#front-end aria-label="anchor link for front-end">#</a> Front-end</h1><p>The frontend first scans the code to produce tokens. Then parses the token stream to an AST. Then it does a bunch of analysis on the AST.<h2 id=scanner><a href=#scanner aria-label="anchor link for scanner">##</a> Scanner</h2><p>A scanner reads the raw text of the file and extracts the interesting tokens from it. This allows the parser to deal with higher-level tokens which makes it easier. It also allows handling error handling/reporting information to be more contained.<p>A scanner is the easiest part to implement normally and can even be done by a <strong>scanner generator</strong>. It can be done <em>lazily</em> (doesn't scan tokens until requested) or <em>greedily</em> (produces all tokens as soon as possible). A scanner generator takes descriptions of the tokens normally using <em>regular expressions</em> to generate a scanner.<p>I won't talk much about the theory here because CSC 333 was pretty extensive. But basically regular expressions are formally equivalent to finite automata (FA). Languages (i.e. sets of strings of symbols) recognized by finite automata are called FA and are closed under union <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mo class=mjx-n><mjx-c class=mjx-c222A></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mo>∪</mo></math></mjx-assistive-mml></mjx-container>, intersection <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mo class=mjx-n><mjx-c class=mjx-c2229></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mo>∩</mo></math></mjx-assistive-mml></mjx-container>, and Kleene star/closure <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mo class=mjx-n><mjx-c class=mjx-c2217></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mo>∗</mo></math></mjx-assistive-mml></mjx-container> which is 0 or more concatenations of strings from the language. We use <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D700"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>ε</mi></math></mjx-assistive-mml></mjx-container> to denote the empty string.<p><em>Note:</em> We often insert a special <code>EOF</code> token at the end of the stream to make sure parsing end successfully.<p>Normally, reserved words or keywords (e.g. <code>for</code>) match all the rules for identifiers. To handle this, whenever we finish an identifier we see if the identifier is a reserved word / keyword and instead return a token for that keyword rather than a generic identifier token.<h3 id=tokenizing><a href=#tokenizing aria-label="anchor link for tokenizing">###</a> Tokenizing</h3><p><em>How do you split a series of characters into tokens?</em> You could use the simple "I need a delimiter" rule (e.g. every token is separated by space), but often people want to write stuff like <code>foo();</code>. Also, sometimes you get code like this which can be surprisingly hard.<pre class=z-code><code><span class="z-plain z-text">intv1=35+v33;
</span></code></pre><p>In general this is done by greedily finding the current word as long as it's legal. If you end in a legal state, then you just made a token and can return to the start state. If you end in an illegal state, then you have reached an error and report it.<h3 id=types-of-scanners><a href=#types-of-scanners aria-label="anchor link for types-of-scanners">###</a> Types of Scanners</h3><p>Fundamentally scanners run on DFAs. There are many way to build a DFA/scanner in code.<p>A <strong>table-driven scanner</strong> essentially just has a giant lookup table where your row is the current state and your column is the input. At every iteration, you look up in the table using your current state and your input to get the cell in the table which is your next state. This is somewhat memory inefficient (tables can be very big) but easy to code and maintain.<p>A <strong>direct-coded scanner</strong> is generally more efficient in terms of memory than the table-driven scanner and somewhat more efficient in terms of runtime. It can be less readable and somewhat harder to maintain though. In practice it's not that hard though. This is the kind of scanner you would make if you made one by hand. You read in a character, switch on the state, and then manually do the comparisons as you want.<h3 id=scanner-dfa-optimization><a href=#scanner-dfa-optimization aria-label="anchor link for scanner-dfa-optimization">###</a> Scanner/DFA Optimization</h3><p>To improve performance of DFAs (especially important for scanner generators), we normally use the following<ul><li>RE to NFA: Build an NFA for each term, combine them all with <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D700"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>ε</mi></math></mjx-assistive-mml></mjx-container>-moves / <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D700"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>ε</mi></math></mjx-assistive-mml></mjx-container>-edges.<li>NFA to DFA: Build the simulation using subset construction.<li>DFA to Minimal DFA: Use Hopcroft's algorithm to minimize the number of states. <em>Can reduce the number of states a LOT.</em><li>DFA to RE:<ul><li><em>Why do this?</em> It can give you a simpler RE.</ul></ul><p>Thompson's construction works by converting the 4 basic possible regular expression operators into an NFA, as shown below. This works on the AST of the parsed regular expressions.<figure><img src=thompsons_construction.png><figcaption><p>Thompson's Construction</figcaption></figure><p>This however produces an extremely large and inefficient FA. However, it is always correct and we have algorithms to optimize them later.<h2 id=parser><a href=#parser aria-label="anchor link for parser">##</a> Parser</h2><p>The chief job of the parser is to produce an <strong>abstract syntax tree</strong> (AST). To do this, the parser uses a formal grammer. Sometimes, finalizing the abstract syntax tree (e.g. in cases of overloading), we need to do context sensitive analysis (e.g. type analysis) that cannot be done by the parser.<h3 id=grammars><a href=#grammars aria-label="anchor link for grammars">###</a> Grammars</h3><p>Before we understand grammars, we need to understand their representation. We use <strong>Backus-Naur form</strong>. The Backus-Naur form describes a grammar as a set of <strong>productions</strong>, where a production is a mapping from a lefthand side to a righthand side with an arrow from left to right. There are <strong>non-terminal</strong> symbols, represented by a capital letters, called such because a valid string in a language cannot have a non-terminal symbol. There are <strong>terminal</strong> symbols, represented by lowercase letters, called such because there are a valid symbol in the alphabet.<p>We use a slightly modified version where we can use non-terminals with multiple letters in their names. To remain unambiguous, our multi-character non-terminals start with uppercase letters and have whitespace around them. Similarly, complex non-terminals (recognized by regular expressions) are wrapped in angle brackets <code>&lt;</code> and <code>></code>.<p>Every string <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>s</mi></math></mjx-assistive-mml></mjx-container> in the language recognized by a grammar has a <strong>derivation</strong>, that is a series of productions that can be applied, starting at the start symbol, to produce / arrive at <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>s</mi></math></mjx-assistive-mml></mjx-container>. The discovering of a derivation is called <strong>parsing</strong>.<p>For review, A <strong>regular grammar</strong> is a grammar where every production has at most one righthand non-terminal symbol and arbitrarily many lefthand terminal symbols. There can be no lefthand non-terminals and no righthand terminals.<pre class=z-code><code><span class="z-plain z-text"># Not regular grammar
S -> AB
A -> aA | \e
B -> bB | \e

# Previous grammar rewritten to be regular
A -> aA | B
B -> bB | \e

# Different no-variable grammar
S -> ab | aabb | aaabbb
</span></code></pre><p>In <strong>context-free grammar</strong> you have a set of productions from a <em>single</em> non-terminal to a series of non-terminals or terminals. If you had multiple non-terminals and terminals on the left hand side, then it would be a <em>context-sensitive grammar</em><pre class=z-code><code><span class="z-plain z-text"># Recognizes a^nb^n. This is context-free.
A -> aAb | \e
# Recognizes a^nb^n n > 1. Also context-free
A -> aAb | aabb

# This is context-sensitive.
AB -> ...
</span></code></pre><p>Parsers are normally driven by context-free grammars rather than context-sensitive grammars because they are easy to implement, easy for humans to understand, and fairly expressive. Basically they're a happy medium.<p>Grammars can be ambiguous, how can we formally classify that? We can't just say a grammar that has multiple possible derivations for a string because then if we have multiple non-terminals at a time then it has derivations depending on whether you derive the left or right first. To get around this, we say a grammar is an <strong>ambiguous grammar</strong> if it has multiple <strong>leftmost derivations</strong> (or equivalently multiple <strong>rightmost derivations</strong>), where a leftmost/rightmost derivation is where you always choose the leftmost or rightmost non-terminal symbol to expand respectively.<p>We do <em>not</em> want the grammars we design to be ambiguous because otherwise people will be surprised by our parser's behavior and there's a good chance that we will introduce bugs by accidentally switching from preferring one ambiguity to the other. Also, we often like to use our parser's grammar to produce an AST that we can then use to help analyze and execute the code. For example, we normally do a post-order walk of binary expressions (e.g. arithmetic) to determine which ones we should do first. Using a post-order walk ensures that expressions lower in the AST get executed first.<p><strong>TODO:</strong> Get image from slide<p>This ambiguity typically occurs when defining arithmetic operations. A naive grammar for arithmetic would be<pre class=z-code><code><span class="z-plain z-text">Expr -> Expr Op Expr
Expr -> [id] | [num]
Op -> + | - | * | /
</span></code></pre><p>However, this is ambiguous, which is a real problem if we want to embed order of operations in an AST. We can handle this in two main ways. Use some sort of precedence parsing, like <em>Pratt parsing</em>, where we give some numbers to our operators which then changes the parser to be unambiguous and take care of precedence. This can be easier to extend but harder to write initially. Alternatively, we can modify the grammar to take care of precedence. Ultimately it's up to a matter of preference. In this class we will modify the grammar. Here is arithmetic operations rewritten to take care of order of operations. You can give these names without numbers but that makes it harder to understand I think.<pre class=z-code><code><span class="z-plain z-text"># Expr is human-friendly alias for the top level
Expr -> L2
L2 -> L2 + L1 | L1 - L1 | L1
L1 -> L1 * L0 | L1 / L0 | L0
L0 -> Atom
# Atom is a human-friendly alias for the bottom
# level
Atom -> [id] | [num] | ( Expr )
</span></code></pre><p><em>But wait, isn't <code>+</code> and <code>-</code> still ambiguous?</em> Nope! Notice that the left non-terminal side is the same level but the right non-terminal is at a lower level. This can have issues with left recursion, but this can again be trivially rewritten using something like<pre class=z-code><code><span class="z-plain z-text"># Left recursive
L1 -> L1 * L0
# Not left recursive, uses {...} repetition.
# Quoted symbols are not magical. Unquoted are
# magic.
L1 -> L0 { "*" L0 }
</span></code></pre><p>There are two ways of parsing we will discuss. There is <strong>top-down parsing</strong>, normally done with hand-coded recursive descent parsers. There is also <strong>bottom-up parsing</strong>, which normally uses a parser generator. There are many types such as LR(1) parsers, PEG parsers, etc.<h3 id=top-down-parsers><a href=#top-down-parsers aria-label="anchor link for top-down-parsers">###</a> Top-Down Parsers</h3><p>Top down parsers are called such because they first start at the start state and gradually get more and more specific. They start at the root of the parse tree and grow towards the leaves. They do this by picking a production and trying to match the input. However, if they pick the incorrect production, they may need to backtrack. Certain languages/grammars are designed such that it is always possible to pick the correct production. This is called <strong>predictive parsing</strong>.<p>We in general discuss <strong>recursive descent parsers</strong> as the classical top down parser. To create a recursive descent parser, you convert every production into a function that returns the AST node produced by the production. If the part of our production is a non-terminal, we call the production for it. If it is a terminal, check that the next token matches. If we have a repetition, like <code>{ expr }</code>, we keep matching <code>expr</code> as much as we can. If we have an alternation, like <code>a | b | c</code>, we try each production in series until we get one that works. (As an optimization, we can match on the first token and switch directly to that production if we have enough data to <em>prodict</em> the correct production.) If we have an optinonal, like <code>[ a ]</code>, we try to match <code>a</code> but if we fail we don't do anything.<p>Here is Rust-like pseudo-code for a recursive descent parser.<pre class="z-code language-rust" data-lang=rust><code class=language-rust data-lang=rust><span class="z-rust z-source"><span class="z-rust z-comment z-double-slash z-line"><span class="z-punctuation z-definition z-comment z-rust">//</span> A -> aA | bB
</span><span class="z-rust z-comment z-double-slash z-line"><span class="z-punctuation z-definition z-comment z-rust">//</span> B -> bBc | c
</span><span class="z-meta z-rust z-impl"><span class="z-rust z-impl z-storage z-type">impl</span> </span><span class="z-meta z-rust z-impl">Parse <span class="z-rust z-keyword z-other">for</span></span><span class="z-meta z-rust z-impl"> <span class="z-rust z-impl z-entity z-name">TokenStream</span> </span><span class="z-meta z-rust z-impl"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-begin z-block z-rust">{</span>
  <span class="z-function z-meta z-rust"><span class="z-function z-meta z-rust"><span class="z-function z-rust z-storage z-type">fn</span> </span><span class="z-function z-entity z-name z-rust">A</span></span><span class="z-function z-meta z-rust"><span class="z-function z-meta z-parameters z-rust"><span class="z-punctuation z-section z-begin z-rust z-parameters">(</span><span class="z-rust z-keyword z-operator">&</span><span class="z-rust z-variable z-parameter">self</span></span><span class="z-function z-meta z-rust"><span class="z-function z-meta z-parameters z-rust"><span class="z-punctuation z-section z-end z-rust z-parameters">)</span></span></span></span><span class="z-function z-meta z-rust"> <span class="z-function z-meta z-rust z-return-type"><span class="z-punctuation z-separator z-rust">-></span> AstNode</span> </span><span class="z-function z-meta z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-begin z-block z-rust">{</span>
    <span class="z-rust z-storage z-type">let</span> node <span class="z-rust z-keyword z-operator z-assignment">=</span> <span class="z-meta z-rust z-path">AstNode<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    <span class="z-rust z-keyword z-control">match</span> <span class="z-rust z-variable z-language">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-function z-support z-rust">peek</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-begin z-block z-rust">{</span>
      <span class="z-rust z-string z-quoted z-single"><span class="z-punctuation z-begin z-definition z-string z-rust">'</span>a<span class="z-punctuation z-end z-definition z-string z-rust">'</span></span> <span class="z-rust z-keyword z-operator">=></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-begin z-block z-rust">{</span>
        node<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-function z-support z-rust">push</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span><span class="z-rust z-variable z-language">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-function z-support z-rust">next</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
        node<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-function z-support z-rust">push</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span><span class="z-rust z-variable z-language">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>A<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
      </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-end z-block z-rust">}</span></span>
      <span class="z-rust z-string z-quoted z-single"><span class="z-punctuation z-begin z-definition z-string z-rust">'</span>b<span class="z-punctuation z-end z-definition z-string z-rust">'</span></span> <span class="z-rust z-keyword z-operator">=></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-begin z-block z-rust">{</span>
        node<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-function z-support z-rust">push</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span><span class="z-rust z-variable z-language">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-function z-support z-rust">next</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
        node<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-function z-support z-rust">push</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span><span class="z-rust z-variable z-language">self</span><span class="z-punctuation z-accessor z-dot z-rust">.</span>B<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
      </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-end z-block z-rust">}</span></span>
      <span class="z-rust z-keyword z-operator">_</span> <span class="z-rust z-keyword z-operator">=></span> <span class="z-rust z-support z-macro">todo!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-begin z-group z-rust">(</span><span class="z-rust z-string z-quoted z-double"><span class="z-punctuation z-begin z-definition z-string z-rust">"</span>do real error handling<span class="z-punctuation z-end z-definition z-string z-rust">"</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-end z-group z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-end z-block z-rust">}</span></span>
    node
  </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-end z-block z-rust">}</span></span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-end z-block z-rust">}</span></span></span>
</span></code></pre><p>Top down parsers have one big weakness. <strong>Left recursion</strong>. Left recursion is when you have a production like <code>A -> A B</code>. In this case, the leftmost symbol <em>always</em> generates itself and we cannot do any matching, instead just looping forever. To get around this, we "unroll" the left recursion into right recursion using repetition. So <code>A -> A B</code> would become <code>A -> { B }</code>. Basically, you make the non-left-recursive branch be its own thing at the start and make all the left-recursive branches be repetitions (with the left-recursion removed). Here's another annotated example.<pre class=z-code><code><span class="z-plain z-text"># Left recursive!
Fee -> Fee a | b

# b was the only terminating branch so it
# becomes the start. Fee a was the
# non-terminating branch, so we repeat it.
Fee -> b { a }

# We could do this more formally with this. It's
# identical to the above.
Fee -> b Fee'
Fee' -> a Fee' | \e
</span></code></pre><p>More formally, what we do is introduce a new non-terminal <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi><mjx-script style=vertical-align:.363em><mjx-mo class=mjx-var size=s><mjx-c class=mjx-c2032></mjx-c></mjx-mo></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><msup><mi>A</mi><mo data-mjx-alternate=1>′</mo></msup></math></mjx-assistive-mml></mjx-container> for every left-recursive non-terminal <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>A</mi></math></mjx-assistive-mml></mjx-container>. The new <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>A</mi></math></mjx-assistive-mml></mjx-container> goes to the terminating branch of the old <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>A</mi></math></mjx-assistive-mml></mjx-container> and the new <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi><mjx-script style=vertical-align:.363em><mjx-mo class=mjx-var size=s><mjx-c class=mjx-c2032></mjx-c></mjx-mo></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><msup><mi>A</mi><mo data-mjx-alternate=1>′</mo></msup></math></mjx-assistive-mml></mjx-container> goes to the <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>A</mi></math></mjx-assistive-mml></mjx-container> non-terminating old branch or the empty string <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D700"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>ε</mi></math></mjx-assistive-mml></mjx-container>. If that sounds confusing, read the following transformations. Basically, <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi><mjx-script style=vertical-align:.363em><mjx-mo class=mjx-var size=s><mjx-c class=mjx-c2032></mjx-c></mjx-mo></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><msup><mi>A</mi><mo data-mjx-alternate=1>′</mo></msup></math></mjx-assistive-mml></mjx-container> is the formal way to do <code>{ ... }</code>.<pre class=z-code><code><span class="z-plain z-text"># Class left-recursive expression grammar
Expr -> Expr + Term | Expr - Term | Term
Term -> Term * Atom | Term / Atom | Atom

# Rewritten not left-recursive expression
# grammar
Expr -> Term Expr'
Expr' -> + Term Expr' | - Term | \e
Term -> Atom Term'
Term' -> * Atom | / Atom | \e
</span></code></pre><p>Not all left-recursion is obvious. We can have <strong>indirect left-recursion</strong> where you have to go through multiple steps initially. See the below example. The same algorithm works.<pre class=z-code><code><span class="z-plain z-text">A -> B a
B -> C b
C -> A c | \e
</span></code></pre><p>Another less important weakness is it is impossible to "look-ahead" at tokens and make decisions based on that. Meaning that grammars like <code>A -> aB | aC</code> are impossible to parse with (formally) recursive descent parsers.<p>We would like to design grammars that can be parsed with recursive descent parsers. That is, we would like a predictive parser. For this to be possible, our grammar needs to <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> property. <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> means left-to-right scanning, leftmost derivation, one lookahead.<p>We define <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> where <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D447"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=3><mjx-c class=mjx-c222A></mjx-c></mjx-mo><mjx-mi class=mjx-i space=3><mjx-c class="TEX-I mjx-c1D441"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D447"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi><mo>∈</mo><mi>T</mi><mo>∪</mo><mi>N</mi><mi>T</mi></math></mjx-assistive-mml></mjx-container> as the set of symbols that are the first symbols in a string that derives from <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi></math></mjx-assistive-mml></mjx-container>. That is, <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>x</mi><mo>∈</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> iff <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mstyle><mjx-mspace style=width:.278em></mjx-mspace></mjx-mstyle><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c27F9></mjx-c></mjx-mo><mjx-msup space=4><mjx-mstyle><mjx-mspace style=width:.278em></mjx-mspace></mjx-mstyle><mjx-script style=vertical-align:.363em><mjx-mo class=mjx-n size=s><mjx-c class=mjx-c2217></mjx-c></mjx-mo></mjx-script></mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FE"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi><mstyle scriptlevel=0><mspace width=0.278em></mspace></mstyle><mo stretchy=false>⟹</mo><msup><mstyle scriptlevel=0><mspace width=0.278em></mspace></mstyle><mo>∗</mo></msup><mi>x</mi><mi>γ</mi></math></mjx-assistive-mml></mjx-container> for some <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FE"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>γ</mi></math></mjx-assistive-mml></mjx-container>. We allow <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D447"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi><mo>∈</mo><mi>T</mi></math></mjx-assistive-mml></mjx-container> because <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mstyle><mjx-mspace style=width:.278em></mjx-mspace></mjx-mstyle><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c27F9></mjx-c></mjx-mo><mjx-msup space=4><mjx-mstyle><mjx-mspace style=width:.278em></mjx-mspace></mjx-mstyle><mjx-script style=vertical-align:.363em><mjx-mo class=mjx-n size=s><mjx-c class=mjx-c2217></mjx-c></mjx-mo></mjx-script></mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi><mstyle scriptlevel=0><mspace width=0.278em></mspace></mstyle><mo stretchy=false>⟹</mo><msup><mstyle scriptlevel=0><mspace width=0.278em></mspace></mstyle><mo>∗</mo></msup><mi>α</mi></math></mjx-assistive-mml></mjx-container>.<p>We define <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45C"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D459"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D459"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45C"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D464"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>f</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>o</mi><mi>w</mi><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> where <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D441"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D447"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi><mo>∈</mo><mi>N</mi><mi>T</mi></math></mjx-assistive-mml></mjx-container> as the set of symbols that can occur immediately after <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi></math></mjx-assistive-mml></mjx-container> in a valid sequence.<p>We define <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-script style=vertical-align:.363em><mjx-mo class=mjx-n size=s><mjx-c class=mjx-c2B></mjx-c></mjx-mo></mjx-script></mjx-msup><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><msup><mi>t</mi><mo>+</mo></msup><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> as <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative display=true><mjx-math aria-hidden=true class=MJX-TEX display=true style=margin-left:0;margin-right:0><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mo class=mjx-n size=s><mjx-c class=mjx-c2B></mjx-c></mjx-mo></mjx-script></mjx-msup><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n space=3><mjx-c class=mjx-c222A></mjx-c></mjx-mo><mjx-mi class=mjx-i space=3><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45C"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D459"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D459"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45C"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D464"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=block unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML display=block><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><msup><mi>t</mi><mo>+</mo></msup><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo><mo>=</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo><mo>∪</mo><mi>f</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>o</mi><mi>w</mi><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container><p>A grammar <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> property of a grammar means that if we have rules <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2192></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>A</mi><mo stretchy=false accent=false>→</mo><mi>α</mi></math></mjx-assistive-mml></mjx-container> and <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D434"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2192></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D6FD"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>A</mi><mo stretchy=false accent=false>→</mo><mi>β</mi></math></mjx-assistive-mml></mjx-container> both in the grammar, we would like <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n space=3><mjx-c class=mjx-c2229></mjx-c></mjx-mo><mjx-mi class=mjx-i space=3><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FD"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-mi class=mjx-n space=4><mjx-c class=mjx-c2205></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo><mo>∩</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo stretchy=false>(</mo><mi>β</mi><mo stretchy=false>)</mo><mo>=</mo><mi mathvariant=normal>∅</mi></math></mjx-assistive-mml></mjx-container>. This would mean that the grammar can look ahead a single token <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c2E></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>x</mi><mo>.</mo></math></mjx-assistive-mml></mjx-container> If <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>x</mi><mo>∈</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo stretchy=false>(</mo><mi>α</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> then pick <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi></math></mjx-assistive-mml></mjx-container>, if <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FD"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>x</mi><mo>∈</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mo stretchy=false>(</mo><mi>β</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container>, then pick <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FD"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>β</mi></math></mjx-assistive-mml></mjx-container>, otherwise error.<p>Let's look at a non <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> grammar.<pre class=z-code><code><span class="z-plain z-text">1. A -> aAb
2. A -> bB
3. A -> \e
4. B -> b
</span></code></pre><p>Consider the string <code>abbb</code>. When doing recursive descent paring, we could get the following two tables<table><thead><tr><th>Rule<th>Sentential Form<th>Input<tbody><tr><td><td><code>A</code><td><code>!abbb</code><tr><td>1<td><code>aAb</code><td><code>a!bbb</code><tr><td>2<td><code>abBb</code><td><code>a!bbb</code></table><table><thead><tr><th>Rule<th>Sentential Form<th>Input<tbody><tr><td><td><code>A</code><td><code>!abbb</code><tr><td>1<td><code>aAb</code><td><code>a!bbb</code><tr><td>3?<td><code>ab</code><td><code>a!bbb</code></table><p>We can transform some (not all!) process is called <strong>left-factoring</strong>. Whenever you have an ambiguous choice, you factor out the first symbol which you have an ambiguous choice to a new common non-terminal. However, given a CFG doesn't meet the <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> condition, it is undecidable whether or not an equivalent an <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> grammar exists.<p>Here is an example of a language which has no <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> grammar.<p><mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative display=true><mjx-math aria-hidden=true class=MJX-TEX display=true style=margin-left:0;margin-right:0><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44E"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mn class=mjx-n><mjx-c class=mjx-c30></mjx-c></mjx-mn><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44F"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-texatom><mjx-mo class=mjx-n space=3><mjx-c class=mjx-c222A></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=3><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44E"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44F"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-texatom texclass=ORD size=s><mjx-mn class=mjx-n><mjx-c class=mjx-c32></mjx-c></mjx-mn><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup></mjx-texatom></mjx-math><mjx-assistive-mml display=block unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML display=block><mi>L</mi><mo>=</mo><mrow data-mjx-texclass=ORD><msup><mi>a</mi><mi>n</mi></msup><mn>0</mn><msup><mi>b</mi><mi>n</mi></msup></mrow><mo>∪</mo><mrow data-mjx-texclass=ORD><msup><mi>a</mi><mi>n</mi></msup><mn>1</mn><msup><mi>b</mi><mrow data-mjx-texclass=ORD><mn>2</mn><mi>n</mi></mrow></msup></mrow></math></mjx-assistive-mml></mjx-container><p>Here is a CFG to recognize <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi></math></mjx-assistive-mml></mjx-container><pre class=z-code><code><span class="z-plain z-text">S -> A | B
A -> aAb | a0b
B -> aBbb | a1bb
</span></code></pre><p>You need an unbounded number of <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44E"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>a</mi></math></mjx-assistive-mml></mjx-container> characters before you can figure out whether to pick <code>A</code> or <code>B</code>. That is, if you say you only need <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>n</mi></math></mjx-assistive-mml></mjx-container>, I can give you a string that requires <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=3><mjx-c class=mjx-c2B></mjx-c></mjx-mo><mjx-mn class=mjx-n space=3><mjx-c class=mjx-c31></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>n</mi><mo>+</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container>.<p><strong>Example:</strong> Is the following grammar an <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> grammar?<pre class=z-code><code><span class="z-plain z-text">G -> M [num] "." [num]
G -> N
M -> "-"
M -> \e
N -> [num]
</span></code></pre><p>This is not an <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> grammar. <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative display=true><mjx-math aria-hidden=true class=MJX-TEX display=true style=margin-left:0;margin-right:0><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mo class=mjx-n size=s><mjx-c class=mjx-c2B></mjx-c></mjx-mo></mjx-script></mjx-msup><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D440"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-mtext class=mjx-n><mjx-c class=mjx-c22></mjx-c><mjx-c class=mjx-c2D></mjx-c><mjx-c class=mjx-c22></mjx-c></mjx-mtext><mjx-mo class=mjx-n><mjx-c class=mjx-c2C></mjx-c></mjx-mo><mjx-mtext class=mjx-n space=2><mjx-c class=mjx-c5B></mjx-c><mjx-c class=mjx-c6E></mjx-c><mjx-c class=mjx-c75></mjx-c><mjx-c class=mjx-c6D></mjx-c><mjx-c class=mjx-c5D></mjx-c></mjx-mtext></mjx-texatom></mjx-math><mjx-assistive-mml display=block unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML display=block><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><msup><mi>t</mi><mo>+</mo></msup><mo stretchy=false>(</mo><mi>M</mi><mo stretchy=false>)</mo><mo>=</mo><mrow data-mjx-texclass=ORD><mtext>"-"</mtext><mo>,</mo><mtext>[num]</mtext></mrow></math></mjx-assistive-mml></mjx-container> <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative display=true><mjx-math aria-hidden=true class=MJX-TEX display=true style=margin-left:0;margin-right:0><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mo class=mjx-n size=s><mjx-c class=mjx-c2B></mjx-c></mjx-mo></mjx-script></mjx-msup><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D441"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-mtext class=mjx-n><mjx-c class=mjx-c5B></mjx-c><mjx-c class=mjx-c6E></mjx-c><mjx-c class=mjx-c75></mjx-c><mjx-c class=mjx-c6D></mjx-c><mjx-c class=mjx-c5D></mjx-c></mjx-mtext></mjx-texatom><mjx-mo class=mjx-n><mjx-c class=mjx-c2E></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=block unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML display=block><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><msup><mi>t</mi><mo>+</mo></msup><mo stretchy=false>(</mo><mi>N</mi><mo stretchy=false>)</mo><mo>=</mo><mrow data-mjx-texclass=ORD><mtext>[num]</mtext></mrow><mo>.</mo></math></mjx-assistive-mml></mjx-container> Means that <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative display=true><mjx-math aria-hidden=true class=MJX-TEX display=true style=margin-left:0;margin-right:0><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mo class=mjx-n size=s><mjx-c class=mjx-c2B></mjx-c></mjx-mo></mjx-script></mjx-msup><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D440"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n space=3><mjx-c class=mjx-c2229></mjx-c></mjx-mo><mjx-mi class=mjx-i space=3><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mo class=mjx-n size=s><mjx-c class=mjx-c2B></mjx-c></mjx-mo></mjx-script></mjx-msup><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D441"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2260></mjx-c></mjx-mo><mjx-mi class=mjx-n space=4><mjx-c class=mjx-c2205></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c2E></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=block unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML display=block><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><msup><mi>t</mi><mo>+</mo></msup><mo stretchy=false>(</mo><mi>M</mi><mo stretchy=false>)</mo><mo>∩</mo><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><msup><mi>t</mi><mo>+</mo></msup><mo stretchy=false>(</mo><mi>N</mi><mo stretchy=false>)</mo><mo>≠</mo><mi mathvariant=normal>∅</mi><mo>.</mo></math></mjx-assistive-mml></mjx-container><p>We can rewrite this grammar to be <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> as such<pre class=z-code><code><span class="z-plain z-text">G -> "-" [num] "." [num]
G -> [num] "." [num]
D -> "." [num]
D -> \e
</span></code></pre><p><strong>Example:</strong> Convert the following grammar into an <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> grammar with no left-recursion.<pre class=z-code><code><span class="z-plain z-text">G -> M N
M -> a b
M -> \e
N -> N a
N -> \e

# Eliminate left recursion
G -> M N
M -> a b
M -> \e
N -> \e N'
N' -> a N'
N' -> \e
# Simplify
G -> M N
G -> N
M -> a b
N -> a N
N -> \e

# Make LL(1)
# Realize that M and N can both start with a.
# Factor that out.
G -> \e
G -> a G'
G' -> b N
G' -> N
N -> a N
N -> \e

# We're done!
</span></code></pre><p><strong>Example:</strong> Let's apply our algorithm to show that not all grammars are <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container>. (Well, really to just give you the idea that not all are. We haven't shown our algorithm always works.)<pre class=z-code><code><span class="z-plain z-text">G -> aAb | aBbb
A -> aAb | 0
B -> aBbb | 1

# Factor out common a in G
G -> a G1
G1 -> Ab
    | Bbb
A -> aAb | 0
B -> aBbb | 1
# Simpler
G -> a G1
G1 -> aAbb
    | 0b
    | aBbbbb
    | 1bb
A -> aAb | 0
B -> aBbb | 1

# Factor out common a in G1
G -> a G1
G1 -> G2
    | 0b
    | 1bb
G2 -> Abb
    | Bbbbb
A -> aAb | 0
B -> aBbb | 1
# Simpler
G -> a G1
G1 -> G2
    | 0b
    | 1bb
G2 -> aAbbb
    | 0bb
    | aBbbbbbb
    | 1bbbb
A -> aAb | 0
B -> aBbb | 1

# Oh no, we have to factor out a common a again.
# We're stuck in an infinite loop...
</span></code></pre><p>As we've gone over, here's the <em>rough</em> procedure for converting an <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> grammar into a recursive descent parser.<ol><li>Remove left recursion via intermediate rules / repetitions.<li>Massage the grammar (removing empty / redundant rules).<li>Do left-factoring until you get rid of all ambiguous rules. (You may have to massage the grammar to make it more obvious.)</ol><h4 id=table-based-recursive-descent-parser><a href=#table-based-recursive-descent-parser aria-label="anchor link for table-based-recursive-descent-parser">####</a> Table-Based Recursive Descent Parser</h4><p>If we're auto-generating a recursive descent parser, one of the easiest ways to do it is to encode your grammar as a giant token-production table because then all you have to do is write a table-driven parser which itself is pretty easy.<p>The table format is every row is a production to follow and the column is the token received. Then your parser keeps track of its current state/row/production, starting at the start state. It checks what the next token is and determines the next production to check.<pre class="z-code language-python" data-lang=python><code class=language-python data-lang=python><span class="z-python z-source"><span class="z-meta z-python z-class"><span class="z-python z-class z-storage z-type"><span class="z-python z-keyword z-declaration z-class">class</span></span> <span class="z-python z-class z-entity z-name"><span class="z-meta z-python z-generic-name">TableParser</span></span><span class="z-punctuation z-section z-begin z-python z-class">:</span></span>
  <span class="z-python z-comment z-block z-documentation"><span class="z-punctuation z-begin z-python z-definition z-comment">"""</span>Table driven parser in pseudo-python.<span class="z-punctuation z-end z-definition z-python z-comment">"""</span></span>

<span class="z-function z-meta z-python">  <span class="z-function z-python z-storage z-type"><span class="z-function z-python z-declaration z-keyword">def</span></span> <span class="z-function z-entity z-name z-python"><span class="z-meta z-python z-generic-name">parse</span></span></span><span class="z-function z-meta z-parameters z-python"><span class="z-punctuation z-section z-begin z-python z-parameters">(</span></span><span class="z-function z-meta z-parameters z-python"><span class="z-python z-variable z-parameter">self</span><span class="z-punctuation z-separator z-python z-parameters">,</span> <span class="z-python z-variable z-parameter">tokens</span><span class="z-punctuation z-section z-end z-python z-parameters">)</span></span><span class="z-function z-meta z-python"><span class="z-function z-python z-begin z-punctuation z-section">:</span></span>
    <span class="z-python z-comment z-block z-documentation"><span class="z-punctuation z-begin z-python z-definition z-comment">"""</span>
    This is like a recursive descent parser
    except we use a loop with a stack because,
    well, that's exactly what recursion does but
    we have to have generic code so it's easier
    to loop like this. (Well, at least that's
    what we say.)
    <span class="z-punctuation z-end z-definition z-python z-comment">"""</span></span>
    <span class="z-python z-comment z-line z-number-sign"><span class="z-punctuation z-definition z-comment z-python">#</span> processing is the current non-terminal or
</span>    <span class="z-python z-comment z-line z-number-sign"><span class="z-punctuation z-definition z-comment z-python">#</span> terminal we're processing
</span>    <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">processing</span></span> <span class="z-python z-keyword z-operator z-assignment">=</span> <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">Stack</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span>
    <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">processing</span></span><span class="z-meta z-python z-qualified-name"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">push</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-meta z-python z-qualified-name"><span class="z-python z-variable z-constant z-other">EOF</span></span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span>
    <span class="z-meta z-python z-statement z-loop z-while"><span class="z-python z-keyword z-control z-loop z-while">while</span> <span class="z-python z-constant z-language">True</span><span class="z-punctuation z-section z-block z-python z-loop z-while">:</span></span>
      <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">want</span></span> <span class="z-python z-keyword z-operator z-assignment">=</span> <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">processing</span></span><span class="z-meta z-python z-qualified-name"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">peek</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span>
      <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">got</span></span> <span class="z-python z-keyword z-operator z-assignment">=</span> <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">tokens</span></span><span class="z-meta z-python z-qualified-name"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">peek</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span>
      <span class="z-meta z-python z-statement z-conditional z-if"><span class="z-python z-keyword z-control z-conditional z-if">if</span> <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">want</span></span> <span class="z-python z-keyword z-operator z-comparison">==</span> <span class="z-meta z-python z-qualified-name"><span class="z-python z-variable z-constant z-other">EOF</span></span> <span class="z-python z-keyword z-operator z-logical">and</span> <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">want</span></span> <span class="z-python z-keyword z-operator z-comparison">==</span> <span class="z-meta z-python z-qualified-name"><span class="z-python z-variable z-constant z-other">EOF</span></span><span class="z-punctuation z-section z-block z-python z-conditional z-if">:</span></span>
        <span class="z-python z-keyword z-control z-flow z-return">return</span> <span class="z-meta z-python z-qualified-name"><span class="z-python z-variable z-constant z-other">AST</span></span>
      <span class="z-meta z-python z-statement z-conditional z-elseif"><span class="z-python z-keyword z-control z-conditional z-elseif">elif</span> <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">instanceof</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">Terminal</span></span><span class="z-punctuation z-separator z-python z-arguments">,</span> <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">want</span></span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span><span class="z-punctuation z-section z-block z-python z-conditional z-elseif">:</span></span>
        <span class="z-meta z-python z-statement z-conditional z-if"><span class="z-python z-keyword z-control z-conditional z-if">if</span> <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">want</span></span> <span class="z-python z-keyword z-operator z-comparison">==</span> <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">got</span></span><span class="z-punctuation z-section z-block z-python z-conditional z-if">:</span></span>
          <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">processing</span></span><span class="z-meta z-python z-qualified-name"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">next</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span>
          <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">tokens</span></span><span class="z-meta z-python z-qualified-name"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">next</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span>
        <span class="z-meta z-python z-statement z-conditional z-else"><span class="z-python z-keyword z-control z-conditional z-else">else</span><span class="z-punctuation z-section z-block z-python z-conditional z-else">:</span></span>
          <span class="z-meta z-python z-statement z-raise"><span class="z-python z-keyword z-control z-flow z-raise">raise</span> <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">Error</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span>
            <span class="z-python z-string z-storage z-type">f</span><span class="z-meta z-python z-interpolated z-string"><span class="z-python z-string z-double z-quoted"><span class="z-punctuation z-begin z-python z-definition z-string">"</span></span></span><span class="z-meta z-python z-interpolated z-string"><span class="z-python z-string z-double z-quoted">expected </span><span class="z-meta z-python z-interpolation"><span class="z-punctuation z-section z-begin z-python z-interpolation">{</span><span class="z-python z-source z-embedded"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">want</span></span></span></span><span class="z-meta z-python z-interpolation"><span class="z-punctuation z-section z-end z-python z-interpolation">}</span></span><span class="z-python z-string z-double z-quoted">, got </span><span class="z-meta z-python z-interpolation"><span class="z-punctuation z-section z-begin z-python z-interpolation">{</span><span class="z-python z-source z-embedded"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">got</span></span></span></span><span class="z-meta z-python z-interpolation"><span class="z-punctuation z-section z-end z-python z-interpolation">}</span></span><span class="z-python z-string z-double z-quoted"><span class="z-punctuation z-end z-definition z-string z-python">"</span></span></span>
          <span class="z-punctuation z-section z-end z-python z-arguments">)</span></span></span>
      <span class="z-meta z-python z-statement z-conditional z-else"><span class="z-python z-keyword z-control z-conditional z-else">else</span><span class="z-punctuation z-section z-block z-python z-conditional z-else">:</span></span>
        <span class="z-python z-comment z-line z-number-sign"><span class="z-punctuation z-definition z-comment z-python">#</span> A -> B1 B2 ... Bn
</span>        <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">new_wants</span></span> <span class="z-python z-keyword z-operator z-assignment">=</span> <span class="z-meta z-python z-item-access"><span class="z-meta z-python z-qualified-name"><span class="z-python z-variable z-language">self</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-python z-generic-name">table</span></span></span><span class="z-meta z-python z-item-access"><span class="z-punctuation z-section z-begin z-python z-brackets">[</span></span><span class="z-meta z-python z-arguments z-item-access"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">want</span></span></span><span class="z-meta z-python z-item-access"><span class="z-punctuation z-section z-end z-python z-brackets">]</span></span><span class="z-meta z-python z-item-access"><span class="z-punctuation z-section z-begin z-python z-brackets">[</span></span><span class="z-meta z-python z-arguments z-item-access"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">got</span></span></span><span class="z-meta z-python z-item-access"><span class="z-punctuation z-section z-end z-python z-brackets">]</span></span>
        <span class="z-meta z-python z-statement z-conditional z-if"><span class="z-python z-keyword z-control z-conditional z-if">if</span> <span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">new_wants</span></span> <span class="z-python z-keyword z-operator z-logical">is</span> <span class="z-python z-constant z-language">None</span><span class="z-punctuation z-section z-block z-python z-conditional z-if">:</span></span>
          <span class="z-meta z-python z-statement z-raise"><span class="z-python z-keyword z-control z-flow z-raise">raise</span> <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">Error</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span>
            <span class="z-python z-string z-storage z-type">f</span><span class="z-meta z-python z-interpolated z-string"><span class="z-python z-string z-double z-quoted"><span class="z-punctuation z-begin z-python z-definition z-string">"</span></span></span><span class="z-meta z-python z-interpolated z-string"><span class="z-python z-string z-double z-quoted">unexpected token for </span><span class="z-meta z-python z-interpolation"><span class="z-punctuation z-section z-begin z-python z-interpolation">{</span><span class="z-python z-source z-embedded"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">want</span></span></span></span><span class="z-meta z-python z-interpolation"><span class="z-punctuation z-section z-end z-python z-interpolation">}</span></span><span class="z-python z-string z-double z-quoted"><span class="z-punctuation z-end z-definition z-string z-python">"</span></span></span>
          <span class="z-punctuation z-section z-end z-python z-arguments">)</span></span></span>
        <span class="z-meta z-python z-statement z-conditional z-else"><span class="z-python z-keyword z-control z-conditional z-else">else</span><span class="z-punctuation z-section z-block z-python z-conditional z-else">:</span></span>
          <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">processing</span></span><span class="z-meta z-python z-qualified-name"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">next</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span>
          <span class="z-python z-comment z-line z-number-sign"><span class="z-punctuation z-definition z-comment z-python">#</span> Push Bn ... B1
</span>          <span class="z-python z-comment z-line z-number-sign"><span class="z-punctuation z-definition z-comment z-python">#</span> This is so B1 is on top
</span>          <span class="z-meta z-python z-statement z-loop z-for"><span class="z-python z-keyword z-control z-loop z-for">for</span> <span class="z-meta z-python z-generic-name">w</span> <span class="z-python z-keyword z-control z-loop z-for z-in">in</span></span><span class="z-meta z-python z-statement z-loop z-for"> <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-function z-support z-builtin z-python">reversed</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">new_wants</span></span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span></span><span class="z-meta z-python z-statement z-loop z-for"><span class="z-punctuation z-section z-block z-python z-loop z-for">:</span></span>
            <span class="z-meta z-python z-function-call"><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">processing</span></span><span class="z-meta z-python z-qualified-name"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-python z-qualified-name"><span class="z-function z-python z-variable"><span class="z-meta z-python z-generic-name">push</span></span></span></span><span class="z-meta z-python z-function-call z-arguments"><span class="z-punctuation z-section z-begin z-python z-arguments">(</span><span class="z-meta z-python z-qualified-name"><span class="z-meta z-python z-generic-name">w</span></span><span class="z-punctuation z-section z-end z-python z-arguments">)</span></span>
</span></code></pre><p>Many high-quality programming languages opt for hand-written parsers because, as you can see above, the error messages are lack-luster and it is hard to give higher quality error messages. Also, the code takes more memory and normally isn't faster.<h3 id=bottom-up-parsers><a href=#bottom-up-parsers aria-label="anchor link for bottom-up-parsers">###</a> Bottom-Up Parsers</h3><p>Bottom up parsers are called such because they start at the leaves gradually build up the abstract syntax tree. Bottom up parsers big weakness is that they do not have very good error reporting. However, they can parse <em>more languages</em> by their nature and they also require <em>no</em> changes to grammars to handle, for example, left-recursion and right-recursion elegantly.<p>We will be discussing <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D445"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>R</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> parsers as the class bottom-up parser. They are named similarly to <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>L</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container>. <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D445"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mn class=mjx-n><mjx-c class=mjx-c31></mjx-c></mjx-mn><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>L</mi><mi>R</mi><mo stretchy=false>(</mo><mn>1</mn><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> means left-to-right scanning, rightmost derivation, one lookahead.<p><strong>TODO:</strong> Watch lecture video<h2 id=context-sensitive-analysis><a href=#context-sensitive-analysis aria-label="anchor link for context-sensitive-analysis">##</a> Context Sensitive Analysis</h2><p>This is where we do type checking and other <strong>semantic analysis</strong>, like undeclared variable usage.<p>For example, this is a type argument mismatch. A parser cannot identify this error so we don't call it a <strong>syntax error</strong>. Instead this is a <strong>semantic error</strong>.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">foo</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">int</span> <span class="z-c z-variable z-parameter">a</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
<span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">main</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-meta z-function-call"><span class="z-c z-function z-variable">foo</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span>Hi<span class="z-c z-punctuation z-end z-definition z-string">"</span></span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><p>Similarly, this is use of an undeclared variable.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">main</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span>a <span class="z-c z-constant z-other z-placeholder">%s</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> a</span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><p><em>Why can't the parser detect semantic errors?</em> Semantic errors often require depending on values, non-local information, and computed information.<p>There are two main approaches to doing semantic analysis: <strong>ad-hoc syntax-directed translation</strong> and <strong>attribute grammars</strong>.<h3 id=ad-hoc-syntax-directed-translation><a href=#ad-hoc-syntax-directed-translation aria-label="anchor link for ad-hoc-syntax-directed-translation">###</a> Ad-Hoc Syntax-Directed Translation</h3><p>To do syntax-directed translation as we discuss here, you associate code with every single production. This code is run while you're parsing, running after every production is taken.<p>Often, computations require some initialization of data (e.g. allocating data). To do this formally we create a <code>Init</code> variable that derives to <code>\e</code> that does all initialization. For example, with determining the cost of executing a basic block. In practice though, we just add some initialization code at the start element. Something like this<pre class=z-code><code><span class="z-plain z-text">Start -> Init BB
Init -> \e  # cost = 0
BB...  # cost += cost(...)
</span></code></pre><p>This could be done by a parser generator. Here's a concrete example using YACC.<pre class="z-code language-yacc" data-lang=yacc><code class=language-yacc data-lang=yacc><span class="z-plain z-text"># $$ refers to the attribute on the lhs
# $n refers to the attribute on the nth element
# of the rhs
Assign -> Ident = Expr;  $$ &lt;- COST(store) + $3
Expr -> Expr + Term;  $$ &lt;- $1 + COST(add) + $3
</span></code></pre><p>Because you are just associating code with productions, this is incredibly flexible. This does restrict the evaluation order to be whatever order you parse things in.<p>Often though if you're doing ad-hoc syntax-directed translation, you won't be using a parser generator because that makes it (generally) easier to write. <em>Why would you ever not use a parser generator?</em> Error messages. Error handling. Maintainability.<h3 id=attribute-grammar><a href=#attribute-grammar aria-label="anchor link for attribute-grammar">###</a> Attribute Grammar</h3><p>Another similar example is attribute grammars.<p>An attribute with additional semantic analysis code an <strong>attribute grammar</strong>. An attribute grammar is a normal CFG augmented with a set of rules. Every symbol in a derivation has a set of <strong>attributes</strong> (e.g. they're structs) and every production has a <strong>code snippet</strong> that describes how to compute a value for each attribute.<p>Here is an example using pseudo-code. It comes the decimal value of a signed binary number.<pre class=z-code><code><span class="z-plain z-text">Number -> Sign List {
  List.pos = 0
  Number.val = if Sign.neg {
    -List.val
  } else {
    List.val
  }
}

Sign -> + { Sign.neg = false }
Sign -> - { Sign.neg = true }

List0 -> List1 Bit {
  List1.pos = List0.pos + 1
  Bit.pos = List0.pos
  List0.val = List1.val + Bit.val
}
List0 -> Bit {
  Bit.pos = List.pos
  Bit.val = List.val
}

Bit -> 0 { Bit.val = 0 }
Bit -> 1 { Bit.val = 2**Bit.pos }
</span></code></pre><p>We can make a graph of how the attributes are computed by an AST with a list of each nodes attributes. For every attribute, we draw an arrow from what the value depends on. For example, <code>List1.pos = List0.pos + 1</code> means that <code>List1.pos</code> depends on <code>List0.pos</code>. This graph must be acyclic for all graphs, otherwise the computation would (possibly) never terminate.<p>One of the weaknesses(?) of attribute grammars is the lack of global variables.<h2 id=type-checking><a href=#type-checking aria-label="anchor link for type-checking">##</a> Type Checking</h2><p>Type checking is a form of correctness verification. It helps statically prevent certain errors. <strong>Type checking</strong> is the process of determining whether type expressions conform to the <strong>type system</strong>, that is a collection on rules for types, of the language.<p>Some languages support <strong>type inference</strong>, which allows the developer to not define the type of a given variable and instead the compiler will infer it from context.<p>We call a language's type system <strong>sound</strong> if no runtime checking is necessary to ensure that the program experiences no type errors at runtime.<p>When we are type checking, we need to determine when two types are equivalent. There are two main ways to define this <em>type equivalence</em>: <strong>structural equivalence</strong> and <strong>name/nominal equivalence</strong>. Two types are structurally equivalent if their types have the same "shape". Two types are nominally equivalent if their types are lexically defined the same. In the below example <code>v1</code> and <code>v3</code> are structurally equivalent and <code>v1</code> and <code>v2</code> are nominally equivalent.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">typedef</span> <span class="z-c z-type z-storage">struct</span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span> <span class="z-c z-type z-storage">int</span> a<span class="z-c z-punctuation z-terminator">;</span> <span class="z-c z-type z-storage">int</span> b<span class="z-c z-punctuation z-terminator">;</span> <span class="z-c z-punctuation z-section z-end z-block">}</span></span> <span class="z-c z-type z-entity z-name z-typedef">X</span><span class="z-c z-punctuation z-terminator">;</span>
<span class="z-c z-type z-storage">typedef</span> <span class="z-c z-type z-storage">struct</span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span> <span class="z-c z-type z-storage">int</span> a<span class="z-c z-punctuation z-terminator">;</span> <span class="z-c z-type z-storage">int</span> b<span class="z-c z-punctuation z-terminator">;</span> <span class="z-c z-punctuation z-section z-end z-block">}</span></span> <span class="z-c z-type z-entity z-name z-typedef">Y</span><span class="z-c z-punctuation z-terminator">;</span>
X v1<span class="z-c z-punctuation z-separator">,</span> v2<span class="z-c z-punctuation z-terminator">;</span>
Y v3<span class="z-c z-punctuation z-terminator">;</span>
</span></code></pre><p>Some people think such strict type-checking / type-equivalence is annoying or needlessly restrictive. To make this easier certain languages support <strong>casts</strong>, which explicitly convert two types using essentially built-in conversion mechanisms, or <strong>coercions</strong>, which are like casts but implicit. If two types are structurally equivalent, the cast has no cost at runtime. If two types are not structurally equivalent, the compiler has to insert simple instructions to for example increase the width of the number. Depending on the languages semantics for casts and coercions, these can cause unexpected bugs or vulnerabilities. For example C will implicitly coerce numbers which may result in integer wraparound which introduces bugs or can even be insecurely optimized by the compiler (since integer wraparound is undefined).<p>How do we determine the type of expressions? We do this using <strong>type synthesis</strong>. Basically the compiler has a list of rules which it either has for built-ins (e.g. <code>int + float -> float</code> or <code>int * int -> int</code>) or determines from analyzing the source code. For example given a declaration like this<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">int</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">write</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">char</span> <span class="z-c z-keyword z-operator">*</span><span class="z-c z-variable z-parameter">s</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> ...
</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><p>If the compiler would saw an expression like <code>write(a)</code>, it would determine that <code>a</code> has type <code>char *</code> and would determine that the entire expression has type <code>int</code>.<h3 id=polymorphism><a href=#polymorphism aria-label="anchor link for polymorphism">###</a> Polymorphism</h3><p>Polymorphism is a really vague term that basically just means that a function or method or class can work with multiple different type.<p>One of the classic methods for doing polymorphism is dynamic dispatch with vtables. Java and Go use this with their interfaces and C++ does it with virtual methods. However, these polymorphic method still need to check their type. But this time we aren't just doing simple type equality because we can accept many different types. How do we handle this?<p>Normally, we use interfaces or abstract classes, or the generic name of <strong>subtyping</strong>. With interfaces or abstract classes we declare the behaviors that the given type must have to be used in place of those interfaces. Languages like Java and C++ use <strong>nominal subtyping</strong>, where the type must explicitly says it implements that abstract class, while languages like Go use <strong>structural subtyping</strong>, where the types must implement all the necessary methods. Then when we try to provide a concrete class to an abstract class our concrete class must be a subtype of the abstract class (in a way stated before). What if we want to assign an abstract class to another abstract class? Then the provided abstract class must be a subtype of the necessary abstract class. This is done using the same mechanisms where the given abstract class must explicitly implement/inherent from the necessary abstract class or must provide the necessary methods.<p><em>Note:</em> All types are considered trivial subtypes of themselves.<p>There is also <strong>parametric polymorphism</strong>, which is the classic <em>generics</em>. Here you statically provide types to a function. This follows all the same subtyping requirements of inheritance. However, here all the subtyping is done at compile time so the language can guarantee more optimizations by not requiring vtables and dynamic dispatch.<p>With dynamic dispatch and especially deeply nested inheritance trees, the overhead necessary to call a virtual method can be very expensive as you have to follow many different points.<h1 id=middle-end><a href=#middle-end aria-label="anchor link for middle-end">#</a> Middle-end</h1><p>Concerned with optimizations of the code. Often do multiple passes using different optimization methods because certain optimizations are more effective after another or benefit from running multiple times. <strong>Must not change the meaning of the code</strong>.<p>Core to the middle-end is the <strong>intermediate representation (IR)</strong> used. There are many IRs that exist that focus on certain things like ease of optimizing, ease of use, level of abstraction, speed of generation, etc. When designing or choosing an IR, you have to carefully design it to optimize it for your use case.<p>There are three main types of IRs:<ul><li>Structural: Graph/Tree based code.<ul><li>Rust's HIR.</ul><li>Linear: Pseudo-assembly for an abstract machine.<ul><li>LLVM IR.</ul><li>Hybrid: Combination of structural and linear used.<ul><li>Control-flow graph.</ul></ul><h2 id=structural-ir><a href=#structural-ir aria-label="anchor link for structural-ir">##</a> Structural IR</h2><p>The canonical structural IR is the <strong>abstract syntax tree (AST)</strong>. This is where every node in your program gets a single node. It is the starting point of most other forms and even several optimizations, since it is directly what you get from the source code. It is like the parse tree except simplified to make it easier to use.<p>Similar to the AST, you can construct a <strong>directed acyclic graph (DAG)</strong>, which is like a tree except branches can go down more than one level and multiple edges (arrows) can point to the same node. This is useful for identifying shared code/expressions, allowing for reducing code motion.<figure><img src=ast_v_dag.png><figcaption><p>Tree vs DAG for Abstract Syntax</figcaption></figure><h2 id=linear-ir><a href=#linear-ir aria-label="anchor link for linear-ir">##</a> Linear IR</h2><p>Linear code tends to be much closer to machine code, often being designed (generally) as more heavily annotated, higher level assembly. They can make low level optimizations (e.g. register allocation) much easier but make analyzing higher level control flow more difficult.<p>There is <strong>stack machine code</strong>, which is mostly used for virtual machines because they are easy to implement. Every operation acts on a global stack except for <code>push</code> and <code>pop</code>. <code>push</code> pushes a new value from memory or immediate onto the stack. <code>pop</code> pops the top value from the stack and stores it into memory.<p>There is <strong>three address code</strong> which is like assembly except every operation can only have exactly 3 operands. For example <code>r0 = r1 + r2</code> is a three address code but <code>r0 = r1 + 2 * r2</code> is not (2 is an immediate and considered an address). This is essentially a generic assembly, because most real hardware have 1-3 operands per instruction, so this maps nicely.<p>There is <strong>static single assignment (SSA)</strong> form, which is actually the most popular linear form used in major compilers today. SSA means that every variable/register is written/set exactly once but can be read/used infinitely many times. This makes analyzing code flow and statement dependency very easy.<p>To make SSA work, we need to do <strong>renaming</strong> and <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D719"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>ϕ</mi></math></mjx-assistive-mml></mjx-container> functions. Renaming is the process of changing to the name of a variable whenever it is written/mutated. The <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D719"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>ϕ</mi></math></mjx-assistive-mml></mjx-container> function is conceptually like a union. It takes multiple different variables and returns one of them at runtime, meaning you can't determine which at compile time. If you have <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-msub><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-script style=vertical-align:-.15em><mjx-mn class=mjx-n size=s><mjx-c class=mjx-c32></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2190></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D719"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-msub><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-script style=vertical-align:-.15em><mjx-mn class=mjx-n size=s><mjx-c class=mjx-c30></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class=mjx-n><mjx-c class=mjx-c2C></mjx-c></mjx-mo><mjx-msub space=2><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-script style=vertical-align:-.15em><mjx-mn class=mjx-n size=s><mjx-c class=mjx-c31></mjx-c></mjx-mn></mjx-script></mjx-msub><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=false>←</mo><mi>ϕ</mi><mo stretchy=false>(</mo><msub><mi>x</mi><mn>0</mn></msub><mo>,</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container>, then <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-msub><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-script style=vertical-align:-.15em><mjx-mn class=mjx-n size=s><mjx-c class=mjx-c32></mjx-c></mjx-mn></mjx-script></mjx-msub></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><msub><mi>x</mi><mn>2</mn></msub></math></mjx-assistive-mml></mjx-container> depends on both <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-msub><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-script style=vertical-align:-.15em><mjx-mn class=mjx-n size=s><mjx-c class=mjx-c30></mjx-c></mjx-mn></mjx-script></mjx-msub></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><msub><mi>x</mi><mn>0</mn></msub></math></mjx-assistive-mml></mjx-container> and <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-msub><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D465"></mjx-c></mjx-mi><mjx-script style=vertical-align:-.15em><mjx-mn class=mjx-n size=s><mjx-c class=mjx-c31></mjx-c></mjx-mn></mjx-script></mjx-msub></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><msub><mi>x</mi><mn>1</mn></msub></math></mjx-assistive-mml></mjx-container>.<h2 id=hybrid-ir><a href=#hybrid-ir aria-label="anchor link for hybrid-ir">##</a> Hybrid IR</h2><p>The <strong>control flow graph</strong> is a graph of how the code flows. You've probably studied it significantly in earlier classes, it's that graph that shows loops and logical branches like a graph. This is useful for higher level optimizations like combining loops, switching loops, and dead code elimination.<h2 id=llvm-project><a href=#llvm-project aria-label="anchor link for llvm-project">##</a> LLVM Project</h2><p>The LLVM project is a large project to produce high quality machine code for a wide range of architectures and wide range of languages. The LLVM project is a collection of optimizers on the LLVM IR (bundled into the <code>opt</code> binary), converting low quality IR to high quality IR, and then backends that produce machine code for various architectures (bundled into <code>llc</code>).<p>Then, new language designers simply need to emit LLVM IR (doesn't even need to be high quality) and suddenly their language will produce high quality machine for a wide variety of architectures. <em>The core part of LLVM is the IR definition and the optimizers.</em><p>Since the LLVM project is a common project for academics who experiment with optimizations work on optimizations and has great industry support, it produces incredibly high quality machine code.<h3 id=llvm-ir><a href=#llvm-ir aria-label="anchor link for llvm-ir">###</a> LLVM IR</h3><p>Here is the LLVM IR assembly language reference: <a href=https://llvm.org/docs/LangRef.html>https://llvm.org/docs/LangRef.html</a><p>The LLVM project uses static single assignment (SSA) IR called LLVM bitcode. It's call bitcode because normally tools use a binary format for efficiency and simplicity. There is also a human readable version that is kinda like RISC assembly code except with infinite registers, types, structs, an understanding of functions, and <em>tons</em> of instructions and annotations, like <a href=https://llvm.org/docs/LangRef.html><code>phi</code></a>, <a href=https://llvm.org/docs/LangRef.html#attr-align><code>align</code></a>, <code>global</code>, etc. All of this makes LLVM IR easy to analyze and high level enough to be efficiently implemented on many machines.<p>Here are a bunch of examples of how some C code could compile to LLVM IR. These examples were cleaned up from examples with Clang 10 <code>-emit-llvm -O1</code>. You can play around with this on <a href=https://godbolt.org/ >Godbolt Compiler Explorer</a>.<h4 id=example-1><a href=#example-1 aria-label="anchor link for example-1">####</a> Example 1</h4><h5 id=c><a href=#c aria-label="anchor link for c">#####</a> C</h5><pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">int</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">square</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">int</span> <span class="z-c z-variable z-parameter">num</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control z-flow z-return">return</span> num <span class="z-c z-keyword z-operator">*</span> num<span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><h5 id=llvm><a href=#llvm aria-label="anchor link for llvm">#####</a> LLVM</h5><pre class="z-code language-llvm" data-lang=llvm><code class=language-llvm data-lang=llvm><span class="z-plain z-text">; %[name] is a register. You can give them any
; name but compilers tend to produce just
; incrementing numbers for simplicity. This is C
; so it's name is mangled like it would be in
; C++ or Rust.
define i32 @square(i32 %num) {
  %1 = alloca i32
  store i32 %num, i32* %1
  %2 = load i32* %1
  %3 = load i32* %1
  %4 = mul i32 %2, %3
  ret i32 %4
}
</span></code></pre><h4 id=example-2><a href=#example-2 aria-label="anchor link for example-2">####</a> Example 2</h4><h5 id=c-1><a href=#c-1 aria-label="anchor link for c-1">#####</a> C</h5><pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">int</span> array<span class="z-c z-meta z-brackets"><span class="z-c z-punctuation z-section z-begin z-brackets">[</span><span class="z-c z-constant z-decimal z-numeric z-integer">100</span><span class="z-c z-punctuation z-section z-end z-brackets">]</span></span><span class="z-c z-punctuation z-terminator">;</span>
<span class="z-c z-type z-storage">int</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">x</span></span><span class="z-c z-meta z-function">

</span><span class="z-c z-meta z-struct"><span class="z-c z-type z-storage">struct</span> <span class="z-c z-meta z-struct"><span class="z-c z-entity z-name z-struct">list</span></span></span><span class="z-c z-meta z-struct"> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-struct"><span class="z-c z-meta z-block">
  <span class="z-c z-type z-storage">int</span> x<span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-meta z-struct"><span class="z-c z-type z-storage">struct</span> <span class="z-c z-meta z-struct"><span class="z-c z-entity z-name z-struct">list</span></span></span><span class="z-c z-meta z-struct"> *next</span><span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-struct"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
</span></code></pre><h5 id=llvm-1><a href=#llvm-1 aria-label="anchor link for llvm-1">#####</a> LLVM</h5><pre class="z-code language-llvm" data-lang=llvm><code class=language-llvm data-lang=llvm><span class="z-plain z-text">%struct.list = type { i32, %struct.list* }

@array =
  global [100 x i32] zeroinitializer, align 16
@x = global i32 0, align 4
</span></code></pre><h4 id=example-3><a href=#example-3 aria-label="anchor link for example-3">####</a> Example 3</h4><h5 id=c-2><a href=#c-2 aria-label="anchor link for c-2">#####</a> C</h5><pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">int</span> <span class="z-c z-keyword z-operator">*</span>ptr<span class="z-c z-punctuation z-terminator">;</span>
ptr <span class="z-c z-keyword z-operator z-assignment">=</span> ptr <span class="z-c z-keyword z-operator z-arithmetic">+</span> <span class="z-c z-constant z-decimal z-numeric z-integer">1</span><span class="z-c z-punctuation z-terminator">;</span>
</span></code></pre><h5 id=llvm-2><a href=#llvm-2 aria-label="anchor link for llvm-2">#####</a> LLVM</h5><pre class="z-code language-llvm" data-lang=llvm><code class=language-llvm data-lang=llvm><span class="z-plain z-text">%ptr = alloca i32*
%1 = load i32** %ptr
%2 = getelementptr i32* %1, i64 1 ; add 1 to ptr
; now %2 is the new pointer
</span></code></pre><h4 id=example-4><a href=#example-4 aria-label="anchor link for example-4">####</a> Example 4</h4><h5 id=c-3><a href=#c-3 aria-label="anchor link for c-3">#####</a> C</h5><pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">int</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">max</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">int</span> <span class="z-c z-keyword z-operator">*</span><span class="z-c z-variable z-parameter">x</span><span class="z-c z-punctuation z-separator">,</span> <span class="z-c z-type z-storage">int</span> <span class="z-c z-variable z-parameter">y</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control">if</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span>x <span class="z-c z-keyword z-operator z-arithmetic">&&</span> <span class="z-c z-keyword z-operator">*</span>x <span class="z-c z-keyword z-operator z-comparison">></span> y<span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-keyword z-control z-flow z-return">return</span> <span class="z-c z-keyword z-operator">*</span>x<span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span> <span class="z-c z-keyword z-control">else</span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-keyword z-control z-flow z-return">return</span> y<span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><h5 id=llvm-3><a href=#llvm-3 aria-label="anchor link for llvm-3">#####</a> LLVM</h5><pre class="z-code language-llvm" data-lang=llvm><code class=language-llvm data-lang=llvm><span class="z-plain z-text">define i32 @max(i32* readonly %0, i32 %1) {
; if (x && %4) {
;   ...
; } else {
;   %7
; }
  %3 = icmp eq i32* %0, null
  br i1 %3, label %7, label %4

; if (... *x > y) {
;   return *x;
; } else {
;   %7
; }
4:
  ; t = *x
  %5 = load i32, i32* %0, align 4
  ; t > y
  %6 = icmp sgt i32 %5, %1
  ; return t or y
  br il %6, label %8, label %7

; return y
7:
  br label %8

8:
  ; if from 7, return y
  ; if from 4, return t = *x
  %9 = phi i32 [ %1, %7 ], [ %5, %4 ]
  ret i32 %9
}
</span></code></pre><p>Some things you can notice is that LLVM IR avoids explicitly representing the stack. This is to more easily support a wider range of machines. It uses <code>alloca</code> instead to represent the stack.<p>It also organizes code into functions with explicit arguments and return instructions. And then functions are organized into modules (by file). Every module is held in memory in a single large data structure. This allows for optimization on a large amount of the program. However, it is not possible to optimize across module (by the compiler). Instead it is done by the linker at link time, called <strong>link time optimization (LTO)</strong>.<h2 id=optimizations><a href=#optimizations aria-label="anchor link for optimizations">##</a> Optimizations</h2><p>There are several clever optimizations that people have thought up for compilers. There are <em><strong>way</strong></em> too many for us to go over extensively.<p>We structure code in basic blocks. If we recognize the connections between these basic blocks in the control flow diagram, we can eliminate dead code, remove unnecessary jump instructions, unlock future optimizations.<p>TODO: Get from 10/21<p><strong>Constant propagation</strong> is the process of evaluating as much code at compile time as you can. Typically this is done by doing arithmetic on constants to result in a smaller simple constant, potentially removing expensive instructions. In the above example, we could simplify <code>someNum()</code> to just <code>147.3</code> which could then be inlined as a constant.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-type z-storage">double</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">someNum</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-type z-storage">int</span> a <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">3</span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-type z-storage">double</span> b <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-float">49<span class="z-c z-punctuation z-separator z-decimal">.</span>3</span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-keyword z-control z-flow z-return">return</span> a <span class="z-c z-keyword z-operator">*</span> b<span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><p><strong>Strength reduction</strong> is the process of replacing expensive instructions with cheaper instructions. For example integer division by 32 can be simplified to a left shift by 5. In fact a lot of multiplications and divisions have extremely clever optimizations like that. If you're iterating over an array using an incrementing index, that can be optimized by a pointer which is just being incremented, replacing an increment, multiplication, and addition with a single addition every loop. Here's an example of a few.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> division replaced with left shift
</span><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">division</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">int</span> <span class="z-c z-variable z-parameter">a</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control z-flow z-return">return</span> a <span class="z-c z-keyword z-operator z-arithmetic">/</span> <span class="z-c z-constant z-decimal z-numeric z-integer">32</span><span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
<span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">division</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">int</span> <span class="z-c z-variable z-parameter">a</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control z-flow z-return">return</span> a <span class="z-c z-keyword z-operator z-arithmetic">>></span> <span class="z-c z-constant z-decimal z-numeric z-integer">5</span><span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>

<span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> incrementing index replaced with pointer
</span><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">arrayIndex</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">int</span> <span class="z-c z-variable z-parameter">arr</span><span class="z-c z-meta z-brackets"><span class="z-c z-punctuation z-section z-begin z-brackets">[</span><span class="z-c z-punctuation z-section z-end z-brackets">]</span></span><span class="z-c z-punctuation z-separator">,</span> <span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-support z-sys-types">size_t</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> n<span class="z-c z-punctuation z-terminator">;</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    arr<span class="z-c z-meta z-brackets"><span class="z-c z-punctuation z-section z-begin z-brackets">[</span>i<span class="z-c z-punctuation z-section z-end z-brackets">]</span></span> <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
<span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">arrayIndex</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">int</span> <span class="z-c z-variable z-parameter">arr</span><span class="z-c z-meta z-brackets"><span class="z-c z-punctuation z-section z-begin z-brackets">[</span><span class="z-c z-punctuation z-section z-end z-brackets">]</span></span><span class="z-c z-punctuation z-separator">,</span> <span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-type z-storage">int</span> <span class="z-c z-keyword z-operator">*</span>end <span class="z-c z-keyword z-operator z-assignment">=</span> arr <span class="z-c z-keyword z-operator z-arithmetic">+</span> n<span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-type z-storage">int</span> <span class="z-c z-keyword z-operator">*</span>p <span class="z-c z-keyword z-operator z-assignment">=</span> arr<span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> in asm p++ would be ptr += sizeof(*p)
</span>  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-punctuation z-terminator">;</span> p <span class="z-c z-keyword z-operator z-comparison">!=</span> end<span class="z-c z-punctuation z-terminator">;</span> p<span class="z-c z-keyword z-operator z-arithmetic">++</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-keyword z-operator">*</span>p <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><p><strong>Reducing code motion</strong> is where you take some identify some expression that is being repeatedly evaluated (e.g. in a loop). If that expression has no side effects and doesn't depend on any values changing in the loop, then you can evaluate that expression once and then store it in a temporary that you repeated reference. Here is an example.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> Calculate the nth prime, very expensive.
</span><span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">nthPrime</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>

<span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> This technically evaluates nthPrime every
</span><span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> time, which is very expensive.
</span><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">codeMotion</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-support z-sys-types">size_t</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> <span class="z-c z-meta z-function-call"><span class="z-c z-function z-variable">nthPrime</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group">n</span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i</span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
<span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> This code is equivalent and evaluate nthPrime
</span><span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> only once.
</span><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">codeMotion</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-type z-support z-sys-types">size_t</span> end <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-meta z-function-call"><span class="z-c z-function z-variable">nthPrime</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group">n</span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span>
  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-support z-sys-types">size_t</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> end<span class="z-c z-punctuation z-terminator">;</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i</span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><p><strong>Loop unrolling</strong> is where you eliminate some jump instructions at the exchange of code bloat by duplicating the code within the loop multiple times. Below is C code with its unrolled version below. This isn't a great example because you don't really reduce the amount of instructions necessary or unlock auto-vectorization optimizations.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> rolled up loop
</span><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">printNums</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-support z-sys-types">size_t</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> n<span class="z-c z-punctuation z-terminator">;</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i</span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>

<span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> unrolled loop by 4
</span><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">printNums</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-type z-support z-sys-types">size_t</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> Handle when n % 4 != 0
</span>  <span class="z-c z-keyword z-control">switch</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span>n <span class="z-c z-keyword z-operator z-arithmetic">%</span> <span class="z-c z-constant z-decimal z-numeric z-integer">4</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
  <span class="z-c z-keyword z-control">case</span> <span class="z-c z-constant z-decimal z-numeric z-integer">3</span><span class="z-c z-punctuation z-separator">:</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span>
  <span class="z-c z-keyword z-control">case</span> <span class="z-c z-constant z-decimal z-numeric z-integer">2</span><span class="z-c z-punctuation z-separator">:</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span>
  <span class="z-c z-keyword z-control">case</span> <span class="z-c z-constant z-decimal z-numeric z-integer">1</span><span class="z-c z-punctuation z-separator">:</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span>
  <span class="z-c z-keyword z-control">case</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-separator">:</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> n<span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-assignment z-augmented">+=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">4</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i</span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i <span class="z-c z-keyword z-operator z-arithmetic">+</span> <span class="z-c z-constant z-decimal z-numeric z-integer">1</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i <span class="z-c z-keyword z-operator z-arithmetic">+</span> <span class="z-c z-constant z-decimal z-numeric z-integer">2</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
    <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span><span class="z-c z-constant z-other z-placeholder">%d</span><span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span><span class="z-c z-punctuation z-separator">,</span> i <span class="z-c z-keyword z-operator z-arithmetic">+</span> <span class="z-c z-constant z-decimal z-numeric z-integer">3</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><p><strong>Loop unswitching</strong> is the process of extracting branches within a loop to outside of the loop. This changes the number of comparisons necessary to finish the loop from <code>n</code> to <code>1</code>, which can make the loop way more efficient to run by itself by reducing the number of jumps and (in some cases) improving instruction cache locality. It can also unlock auto-vectorization. Here is an example of a loop and its unswitched version.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> original loop
</span><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">printStuff</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-separator">,</span> <span class="z-c z-type z-storage">bool</span> <span class="z-c z-variable z-parameter">a</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-support z-sys-types">size_t</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> n<span class="z-c z-punctuation z-terminator">;</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-keyword z-control">if</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span>a<span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
      <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span>a<span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
    <span class="z-c z-punctuation z-section z-end z-block">}</span></span> <span class="z-c z-keyword z-control">else</span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
      <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span>b<span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
    <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>

<span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> unswitched loop
</span><span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">printNums</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-support z-sys-types">size_t</span> <span class="z-c z-variable z-parameter">n</span><span class="z-c z-punctuation z-separator">,</span> <span class="z-c z-type z-storage">bool</span> <span class="z-c z-variable z-parameter">a</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control">if</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span>a<span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-support z-sys-types">size_t</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> n<span class="z-c z-punctuation z-terminator">;</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
      <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span>a<span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
    <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span> <span class="z-c z-keyword z-control">else</span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-support z-sys-types">size_t</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> n<span class="z-c z-punctuation z-terminator">;</span> i<span class="z-c z-keyword z-operator z-arithmetic">++</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
      <span class="z-c z-meta z-function-call"><span class="z-c z-function z-C99 z-support">printf</span><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-string z-double z-quoted"><span class="z-c z-punctuation z-begin z-definition z-string">"</span>b<span class="z-c z-constant z-character z-escape">\n</span><span class="z-c z-punctuation z-end z-definition z-string">"</span></span></span></span><span class="z-c z-meta z-function-call"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-punctuation z-terminator">;</span>
    <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><h3 id=caches-and-optimizations><a href=#caches-and-optimizations aria-label="anchor link for caches-and-optimizations">###</a> Caches and Optimizations</h3><p>TODO: Get from 10/21 lecture<p><strong>False sharing</strong> is when two concurrently running processes continuously read and write memory from the same cache line, even when the memory that they're actually using is different. This is especially impactful when the two processes are running on different CPUs. This means that every time one process writes to the memory in the same cache line, it has to load it from the cache and invalidate the other processes memory. This means that when the other process next tries to write to that memory in the same cache line, it has to load it from memory and invalidate the other processes memory. This results in your processes continuously copying the cache line back and forth, thrashing memory and wasting a ton of time.<p>This example below results in false sharing (taken from Wikipedia), where <code>sum_x</code> needs to continually re-read <code>x</code> from main memory (instead of cache) even though <code>inc_y</code>'s concurrent modification of <code>y</code> is irrelevant.<pre class="z-code language-c" data-lang=c><code class=language-c data-lang=c><span class="z-c z-source"><span class="z-c z-meta z-struct"><span class="z-c z-type z-storage">struct</span> <span class="z-c z-meta z-struct"><span class="z-c z-entity z-name z-struct">foo</span></span></span><span class="z-c z-meta z-struct"> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-struct"><span class="z-c z-meta z-block">
  <span class="z-c z-type z-storage">int</span> x<span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-type z-storage">int</span> y<span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-struct"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span><span class="z-c z-punctuation z-terminator">;</span>

<span class="z-c z-storage z-modifier">static</span> <span class="z-c z-type z-storage">struct</span> foo f<span class="z-c z-punctuation z-terminator">;</span>

<span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> The two following functions are running
</span><span class="z-c z-comment z-double-slash z-line"><span class="z-c z-punctuation z-definition z-comment">//</span> concurrently
</span><span class="z-c z-type z-storage">int</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">sum_x</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">void</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-type z-storage">int</span> s <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-storage">int</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> <span class="z-c z-constant z-decimal z-numeric z-integer">1000000</span><span class="z-c z-punctuation z-terminator">;</span> <span class="z-c z-keyword z-operator z-arithmetic">++</span>i<span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    s <span class="z-c z-keyword z-operator z-assignment z-augmented">+=</span> f<span class="z-c z-punctuation z-accessor">.</span><span class="z-c z-variable z-member z-other">x</span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
  <span class="z-c z-keyword z-control z-flow z-return">return</span> s<span class="z-c z-punctuation z-terminator">;</span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>

<span class="z-c z-type z-storage">void</span> <span class="z-c z-meta z-function"><span class="z-c z-function z-entity z-name">inc_y</span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span></span></span><span class="z-c z-meta z-function z-parameters"><span class="z-c z-meta z-group"><span class="z-c z-type z-storage">void</span><span class="z-c z-punctuation z-section z-group z-end">)</span></span></span><span class="z-c z-meta z-function"> </span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span></span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block">
  <span class="z-c z-keyword z-control">for</span> <span class="z-c z-meta z-group"><span class="z-c z-punctuation z-section z-group z-begin">(</span><span class="z-c z-type z-storage">int</span> i <span class="z-c z-keyword z-operator z-assignment">=</span> <span class="z-c z-constant z-decimal z-numeric z-integer">0</span><span class="z-c z-punctuation z-terminator">;</span> i <span class="z-c z-keyword z-operator z-comparison">&lt;</span> <span class="z-c z-constant z-decimal z-numeric z-integer">1000000</span><span class="z-c z-punctuation z-terminator">;</span> <span class="z-c z-keyword z-operator z-arithmetic">++</span>i<span class="z-c z-punctuation z-section z-group z-end">)</span></span> <span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-begin z-block">{</span>
    <span class="z-c z-keyword z-operator z-arithmetic">++</span>f<span class="z-c z-punctuation z-accessor">.</span><span class="z-c z-variable z-member z-other">y</span><span class="z-c z-punctuation z-terminator">;</span>
  <span class="z-c z-punctuation z-section z-end z-block">}</span></span>
</span></span><span class="z-c z-meta z-function"><span class="z-c z-meta z-block"><span class="z-c z-punctuation z-section z-end z-block">}</span></span></span>
</span></code></pre><h1 id=back-end><a href=#back-end aria-label="anchor link for back-end">#</a> Back-end</h1><p>The back-end primarily has three responsibilities: instruction selection, instruction scheduling, and register allocation. Optimal register allocation is an NPC problem, so often we just use heuristics to ensure near-optimal solutions. This is similar to what we do for other optimizations.<p>As time goes on, hardware becomes more and more complex because they are no longer designed to be understood primarily by humans and instead to be primarily understood by compilers/computers. This can allow us to have higher performance computers for cheaper. Because of this, ISAs are getting increasingly complex. The compiler must understand this and produce high quality code, hiding these complexities from the programmer.<h2 id=memory-and-compilers><a href=#memory-and-compilers aria-label="anchor link for memory-and-compilers">##</a> Memory and Compilers</h2><p>Compilers need to understand the memory layout of the machine they're running on. That way they can efficiently map the abstract memory model of the high level language to the hardware's memory.<p>A traditional C-like memory model (which is what most languages use) has a read-only code segment, a read-write static segment, a heap, and a stack. The code segment and static segment have a known size at compile time, but the heap and stack are growable and only known at runtime.<p>Normally, we put the read-only code segment at the lowest addresses. Immediately after that we have mutable memory in a static segment. These have a known size at compile time so we can put them directly next to each other. Then, to prevent the heap and stack from running into each other, we put the heap immediately after the static segment, having it grow to higher addresses, and we have the stack be at the highest addresses, having it grown down to lower addresses.<p>Having the stack and the heap really far apart used to be relevant when we didn't have paged memory and virtual addresses, so we really needed to ensure that the heap and the stack don't run into each other. Even as we have paged memory this is still useful so we can pretend that memory is a single flat address space without worrying about addresses collide.<h2 id=procedure-abstraction><a href=#procedure-abstraction aria-label="anchor link for procedure-abstraction">##</a> Procedure Abstraction</h2><p>Functions are an incredibly common abstraction across languages and even in assembly. How do we efficiently implement this on a machine which doesn't have native support for procedures? First, to be able to call functions at all you need a calling convention. You could use the standard C calling convention, you could specify your own, or you could make your calling convention unspecified.<p>In general, to implement a procedure you have to perform the following steps:<ol><li>The callers stores program state before it calls the procedure. For example it pushes the instruction pointer to a known place and also stores the registers it cares about onto the stack.<li>The caller jumps jumps to the address of the procedure it's calling.<li>The called procedure stores all registers it uses that the calling convention tells it to store.<li>The procedure does its work.<li>The procedure reverts the registers it stored.<li>The procedure jumps to the known instruction pointer location.<li>The caller restores all the registers it stored onto the stack.</ol><p>As you can see, this is fairly expensive but also incredibly common. As such many machines provide hardware interfaces to more efficiently call procedures.<p>In order to more easily organize the information and data local to each procedure, we create something call <strong>activation records</strong> (AR) or <strong>stack frames</strong>. These are <strong>application binary interface</strong> (ABI) dependent (i.e. machine dependent) information about each procedure call. It's exact structure depends on language and machine but often they contain the parameters for the function, the return address, and all the local data.<figure><img src=stack_frame.png><figcaption><p>Stack Frame / Activation Record</figcaption></figure><p>Most languages put activation records on the stack (hence the name stack frame) because they are only used during the execution of the function. For some languages (like ML) put activation records on the heap because activation records may be used after the heap.<h3 id=calling-conventions><a href=#calling-conventions aria-label="anchor link for calling-conventions">###</a> Calling Conventions</h3><p>To maintain activation records, the caller must go through a pre-call sequence and a post-return sequence. Likewise the callee needs to go through a standard prolog and a standard epilog<p>This standard sequence is calling the calling convention. It determines what registers need to be saved by the caller, what registers need to be saved by the callee, where arguments are stored, where return values are stored, where return addresses are stored, and all that fun stuff.<p>Here is some more information about the System V ABI for the Intel386 architecture. That is the C ABI for the Intel architectures. <a href=http://sco.com/developers/devspecs/abi386-4.pdf>http://sco.com/developers/devspecs/abi386-4.pdf</a><h2 id=instruction-selection><a href=#instruction-selection aria-label="anchor link for instruction-selection">##</a> Instruction Selection</h2><p><strong>Instruction selection</strong> along with <strong>instruction scheduling</strong> and <strong>register allocation</strong> is one of the most important backend choices. For most machines, there are many different ways to perform a computation where the cost depends on the context. A classic example is that <code>mov rax, 0</code> is the same as <code>xor rax, rax</code>.<p>Generally, the backend does this using a code generator with a set of rewrite rules. These rewrite rules describe all the ways the IR can be converted to a specific (series of) instructions. You normally do this by doing a post-order traversal / bottom-up walk of the tree to convert expressions into instructions. However, there are many matches for these rewrite rules for every expression, each with different costs. How do we do we find the lowest-cost match for each subtree?<p>One easy way is to compute all possible matches and choose the cheapest one. This can be absurdly expensive as your list of operations increases. There is also methods using dynamic programming.<h2 id=instruction-scheduling><a href=#instruction-scheduling aria-label="anchor link for instruction-scheduling">##</a> Instruction Scheduling</h2><p><strong>Instruction scheduling</strong> is the process of reordering instructions for optimal execution. This is necessary when / because instructions can take different number of cycles to complete and thus have different latencies. By reordering instructions you "hide" the latencies. Essentially you want to do as much as you can before you hit an instruction which depends on a previous instruction. You can also potentially reduce the number of necessary registers.<p>This may be unintuitive but consider the following example.<pre class="z-code language-asm" data-lang=asm><code class=language-asm data-lang=asm><span class="z-assembly z-source"><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">W</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">&lt;</span><span class="z-assembly z-source">-</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">w</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-source">*</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-source">*</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">x</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-source">*</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">y</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-source">*</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">z</span>

<span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">S</span><span class="z-function z-entity z-name z-assembly">c</span><span class="z-function z-entity z-name z-assembly">h</span><span class="z-function z-entity z-name z-assembly">e</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">u</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">e</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">1</span>
<span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">a</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">w</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">1</span>
<span class="z-assembly z-control z-keyword">add</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">4</span>
<span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">a</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">x</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">5</span>
<span class="z-function z-entity z-name z-assembly">m</span><span class="z-function z-entity z-name z-assembly">u</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">t</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">8</span>
<span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">a</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">y</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">9</span>
<span class="z-function z-entity z-name z-assembly">m</span><span class="z-function z-entity z-name z-assembly">u</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">t</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">12</span>
<span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">a</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">z</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">13</span>
<span class="z-assembly z-control z-keyword">add</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">16</span>
<span class="z-function z-entity z-name z-assembly">s</span><span class="z-function z-entity z-name z-assembly">t</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">e</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">w</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">18</span>
<span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">21</span>

<span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">S</span><span class="z-function z-entity z-name z-assembly">c</span><span class="z-function z-entity z-name z-assembly">h</span><span class="z-function z-entity z-name z-assembly">e</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">u</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">e</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">2</span>
<span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">a</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">w</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">1</span>
<span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">a</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">x</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">2</span>
<span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">a</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">y</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">3</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">3</span>
<span class="z-assembly z-control z-keyword">add</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">4</span>
<span class="z-assembly z-control z-keyword">add</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">5</span>
<span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">a</span><span class="z-function z-entity z-name z-assembly">d</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">z</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">6</span>
<span class="z-function z-entity z-name z-assembly">m</span><span class="z-function z-entity z-name z-assembly">u</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">t</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">3</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">7</span>
<span class="z-function z-entity z-name z-assembly">m</span><span class="z-function z-entity z-name z-assembly">u</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly">t</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">2</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">9</span>
<span class="z-function z-entity z-name z-assembly">s</span><span class="z-function z-entity z-name z-assembly">t</span><span class="z-function z-entity z-name z-assembly">o</span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">e</span><span class="z-function z-entity z-name z-assembly">A</span><span class="z-function z-entity z-name z-assembly">l</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">1</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">=</span><span class="z-function z-entity z-name z-assembly">></span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">r</span><span class="z-function z-entity z-name z-assembly">0</span><span class="z-assembly z-source">,</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">@</span><span class="z-function z-entity z-name z-assembly">w</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">11</span>
<span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly">/</span><span class="z-function z-entity z-name z-assembly"> </span><span class="z-assembly z-character z-constant z-decimal">14</span>
</span></code></pre><p>As you can see the schedule 2 took fewer cycles because it moved instructions that depends on previous instructions farther apart. This allows the machine to make more progress while the other instruction(s) it depends on are in flight.<p>Note that schedule 2 also uses more registers. In some cases thus it would be worse if it requires more cycles to spill the registers than it saves.<p>To help determine what instructions depend on each other, we build a <strong>dependence graph</strong>, which is a directed graph. Each node in the graph is an operation and every instruction's node has an arrow pointing directly to the instruction which depend on it / must occur after it. Often each node is annotated with the latency of the nodes plus all of its dependents.<p>There is a strategy to scheduling instructions called <strong>local list instruction scheduling</strong>. It is done as follows.<ol><li>Build a dependence graph <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43A"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>G</mi></math></mjx-assistive-mml></mjx-container>.<li>Compute a priority function over the nodes in <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43A"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>G</mi></math></mjx-assistive-mml></mjx-container>. (The priority function determines the latency of the instruction.)</ol><p><em>What are the weaknesses of this technique?</em> We can't determine what branch will be taken, even which branch will be taken most of the time. We can't determine where a load or store will occur in memory, for example will most of the loads and stores of this variable be cache misses or cache hits? Those can hugely effect the latency of the instruction.<h2 id=register-allocation><a href=#register-allocation aria-label="anchor link for register-allocation">##</a> Register Allocation</h2><p><strong>Register allocation</strong> is the process of deciding what data goes where in the machine.<p>A critical part of doing register allocation is determining the <strong>liveness</strong> of a variable. A variable is live between its definition and its last use, the range of these instructions / blocks is called its <strong>live range</strong>. Analysis of live ranges is way easier if you use static single assignment (SSA) form.<p>If you have more variables alive at some time than your machine has registers, then you won't be able to hold all of the values in registers and will have to <strong>spill</strong> some. A register spill is just when you store the contents of the variable into memory (e.g. on the stack).<p>We can transform register allocation into a graph coloring problem by using an <strong>interference graph</strong>. To create an interference graph, create a node for every variable (in SSA form). Whenever two variables are alive at the same time, connect them with an edge. Now we can transform register allocation into graph coloring by assigning each register a color and trying to minimize the number of colors <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D458"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>k</mi></math></mjx-assistive-mml></mjx-container> necessary to color the graph. If <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D458"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>k</mi></math></mjx-assistive-mml></mjx-container> is less than or equal to the number registers in your machine, then you're good. If <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D458"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>k</mi></math></mjx-assistive-mml></mjx-container> is greater than the number of registers in your machine, you need to find the optimal way to make the graph color-able using the number of registers in your machine. You modify the graph by introducing loads and stores, called register spills. You need to minimize the number of necessary spills as well.<p>Both of these problems (<mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D458"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>k</mi></math></mjx-assistive-mml></mjx-container>-color-ability and minimizing the number of spills) is NP-Complete, essentially meaning they are extremely difficult. (Formally, there is no known way to solve the problems in polynomial time, and they are "as hard" as all other NP problems.)<p>One heuristic algorithm to perform register allocation is <a href="https://en.wikipedia.org/wiki/Chaitin's_algorithm"><strong>Chaitin's algorithm</strong></a>. It was actually the first register allocation algorithm that used graph coloring!<h1 id=theoretical-stuff><a href=#theoretical-stuff aria-label="anchor link for theoretical-stuff">#</a> Theoretical Stuff</h1><h2 id=chomsky-s-hierarchy><a href=#chomsky-s-hierarchy aria-label="anchor link for chomsky-s-hierarchy">##</a> Chomsky's Hierarchy</h2><p><strong>Chomsky's hierarchy</strong> of languages/grammars is a way of categorizing <strong>grammars</strong>. A grammar <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43A"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D441"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c2C></mjx-c></mjx-mo><mjx-mi class=mjx-n space=2><mjx-c class=mjx-c3A3></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c2C></mjx-c></mjx-mo><mjx-mi class=mjx-i space=2><mjx-c class="TEX-I mjx-c1D443"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c2C></mjx-c></mjx-mo><mjx-mi class=mjx-i space=2><mjx-c class="TEX-I mjx-c1D446"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>G</mi><mo>=</mo><mo stretchy=false>(</mo><mi>N</mi><mo>,</mo><mi mathvariant=normal>Σ</mi><mo>,</mo><mi>P</mi><mo>,</mo><mi>S</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> is a set of non-terminal symbols <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D441"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>N</mi></math></mjx-assistive-mml></mjx-container>, terminal symbols <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-n><mjx-c class=mjx-c3A3></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi mathvariant=normal>Σ</mi></math></mjx-assistive-mml></mjx-container>, and productions <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D443"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>P</mi></math></mjx-assistive-mml></mjx-container>. One non-terminal <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D446"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D441"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>S</mi><mo>∈</mo><mi>N</mi></math></mjx-assistive-mml></mjx-container> is considered the start symbol. Productions <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D6FC"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2192></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D6FD"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D443"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>α</mi><mo stretchy=false accent=false>→</mo><mi>β</mi><mo>∈</mo><mi>P</mi></math></mjx-assistive-mml></mjx-container> are rules that allow you to go from a sequence of lefthand side symbols $\alpha \in (N \cup \Sigmap)^<em><mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45C"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45C"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44E"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D452"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45E"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D462"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D452"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D450"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D452"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45C"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D453"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D456"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D454"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c210E"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D461"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c210E"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44E"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D451"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D466"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45A"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44F"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45C"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D459"></mjx-c></mjx-mi><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D460"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>t</mi><mi>o</mi><mi>t</mi><mi>o</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>o</mi><mi>f</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>s</mi><mi>y</mi><mi>m</mi><mi>b</mi><mi>o</mi><mi>l</mi><mi>s</mi></math></mjx-assistive-mml></mjx-container>\beta \in (N \cup \Sigmap)^</em>$. We can categorize grammars by the amount of restrictions placed on them. This allows us to categorize their computability.<ul><li>Regular Grammar: A grammar where every production has at most one righthand non-terminal symbol and arbitrarily many lefthand terminal symbols. There can be no lefthand non-terminals and no righthand terminals. This is called a righthand grammar, but if we switch the left and right rules we get a lefthand grammar.<li>Context Free Grammar: A grammar where the lefthand side of productions is a single non-terminal and the righthand side is an arbitrary combination of terminals and non-terminals.<li>Context Sensitive Grammar: A grammar where the lefthand side of productions is an arbitrary combination of non-terminals but no terminals and the righthand side is an arbitrary combination of terminals and non-terminals.<li>Unrestricted Grammar: A grammar where the lefthand side of productions can have any arbitrary combination of terminal and non-terminals and the righthand side of productions can have again any arbitrary combinations.</ul><p><em>Note:</em> Technically these grammars are supersets of each other, but normally when we say a grammar is "context free" we mean that it is the minimal encompassing classification, that is it is not regular. Even though all regular grammars and context free grammars.<p>A <em>regular grammar</em> is guaranteed to be able to be parsed/validated in <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative><mjx-math aria-hidden=true class=MJX-TEX><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D442"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c28></mjx-c></mjx-mo><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mo class=mjx-n><mjx-c class=mjx-c29></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml display=inline unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML><mi>O</mi><mo stretchy=false>(</mo><mi>n</mi><mo stretchy=false>)</mo></math></mjx-assistive-mml></mjx-container> linear time by a <em>finite automata</em> (e.g. NFA). A <em>context free grammar</em> (CFG) can be computed in linear time by a <em>pushdown automated</em> (PDA).<p><strong>Example:</strong> The following is a regular language recognized by the regular grammar below. <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative display=true><mjx-math aria-hidden=true class=MJX-TEX display=true style=margin-left:0;margin-right:0><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44E"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3A></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-mi class="mjx-b mjx-ds"><mjx-c class="TEX-A mjx-c2115"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml display=block unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML display=block><mi>L</mi><mo>=</mo><mrow data-mjx-texclass=ORD><msup><mi>a</mi><mi>n</mi></msup><mo>:</mo><mi>n</mi><mo>∈</mo><mrow data-mjx-texclass=ORD><mi mathvariant=double-struck>N</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container><pre class=z-code><code><span class="z-plain z-text">A -> aA | a
</span></code></pre><p><strong>Example:</strong> The following is a context free language recognized by the context free grammar below. <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative display=true><mjx-math aria-hidden=true class=MJX-TEX display=true style=margin-left:0;margin-right:0><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44E"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44F"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3A></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-mi class="mjx-b mjx-ds"><mjx-c class="TEX-A mjx-c2115"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml display=block unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML display=block><mi>L</mi><mo>=</mo><mrow data-mjx-texclass=ORD><msup><mi>a</mi><mi>n</mi></msup><msup><mi>b</mi><mi>n</mi></msup><mo>:</mo><mi>n</mi><mo>∈</mo><mrow data-mjx-texclass=ORD><mi mathvariant=double-struck>N</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container><pre class=z-code><code><span class="z-plain z-text">A -> aAb | ab
</span></code></pre><p><strong>Example:</strong> The following is a context sensitive language. <mjx-container class=MathJax jax=CHTML style=font-size:113.1%;position:relative display=true><mjx-math aria-hidden=true class=MJX-TEX display=true style=margin-left:0;margin-right:0><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D43F"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3D></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44E"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D44F"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-msup><mjx-mi class=mjx-i><mjx-c class="TEX-I mjx-c1D450"></mjx-c></mjx-mi><mjx-script style=vertical-align:.413em><mjx-mi class=mjx-i size=s><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c3A></mjx-c></mjx-mo><mjx-mi class=mjx-i space=4><mjx-c class="TEX-I mjx-c1D45B"></mjx-c></mjx-mi><mjx-mo class=mjx-n space=4><mjx-c class=mjx-c2208></mjx-c></mjx-mo><mjx-texatom texclass=ORD space=4><mjx-mi class="mjx-b mjx-ds"><mjx-c class="TEX-A mjx-c2115"></mjx-c></mjx-mi></mjx-texatom></mjx-texatom></mjx-math><mjx-assistive-mml display=block unselectable=on><math xmlns=http://www.w3.org/1998/Math/MathML display=block><mi>L</mi><mo>=</mo><mrow data-mjx-texclass=ORD><msup><mi>a</mi><mi>n</mi></msup><msup><mi>b</mi><mi>n</mi></msup><msup><mi>c</mi><mi>n</mi></msup><mo>:</mo><mi>n</mi><mo>∈</mo><mrow data-mjx-texclass=ORD><mi mathvariant=double-struck>N</mi></mrow></mrow></math></mjx-assistive-mml></mjx-container><h1 id=performance-analysis><a href=#performance-analysis aria-label="anchor link for performance-analysis">#</a> Performance Analysis</h1><p>This stuff is research which the professor is working on. It's not <em>incredibly</em> relevant to constructing compilers but understanding performance and how to debug it is good for optimizations.<h2 id=drcctprof><a href=#drcctprof aria-label="anchor link for drcctprof">##</a> DrCCTProf</h2><p><em>CCT stands for calling context tree. DrCCTProf is developed by the professor's research group and examples and docs can be found in the slides.</em><p>In this class we will use <a href=https://github.com/Xuhpclab/DrCCTProf>DrCCTProf</a> which is a binary analyzer that tracks instructions (operator and operands), registers (SIMD and general purpose), memory location, and storage locations of variable (register or memory). It is designed to efficiently allow for call path analysis, with ~2x overhead compared to the 100-1000x overhead of Valgrind.<p>It is built on <a href=https://dynamorio.org/ >DynamoRIO</a>. DynamoRIO does dynamic binary instrumentation and is maintained by Google and is programmable using DynamoRIO clients, which are programmed by registering event handlers. It allows you to do things such as count the number of basic blocks executed during execution.<p>Compared to DynamoRIO, DrCCTProf provides a (slightly) nicer (undocumented) API for analyzing call path. It automatically builds a calling context tree and interns symbols (optionally). It builds the calling context tree to enable constant time querying of the call path because you just look up something from a tree instead of unwinding the stack.<h3 id=drcctprof-usage><a href=#drcctprof-usage aria-label="anchor link for drcctprof-usage">###</a> DrCCTProf Usage</h3><p>The general usage is initialization, instrumentation, analysis, storage, and output.<ul><li>Initialization: Open files and call into DynamoRIO to initialize.<li>Instrumentation: Instruct DrCCTProf about what things it should look at and what it should do when sees a certain thing (e.g. basic-block, instruction, etc.).<li>Analysis: Run the program with the instrumentation.<li>Storage: The instrumentation needs to efficiently store the memory either in DrCCTProf's <code>Map&lt;uint64_t, uint64_t></code> or <a href=https://en.wikipedia.org/wiki/Shadow_memory>shadow memory</a>.<li>Output: Collect/aggregate all of the stored information and create output.</ul><p>DrCCTProf outputs data in a format which is compatible to HPCToolkin, a Java GUI used to visualize the information more easily than the raw text output.<h3 id=call-path-importance><a href=#call-path-importance aria-label="anchor link for call-path-importance">###</a> Call Path Importance</h3><p>To detect issues with generated code performance, we often need to know how the code was reached. That way we can detect redundant/inefficient code. For example, this basic block appeared twice in my execution trace, is that redundant code in code generation or am I duplicating work? Without the call path this is hard to determine.<p>It also allows detection of:<ul><li>Memory Safety Issues: data races, out of bounds array access.<li>Performance Issues: False sharing detection (cache issues), etc.</ul><h3 id=data-centric-drcctprof><a href=#data-centric-drcctprof aria-label="anchor link for data-centric-drcctprof">###</a> Data-centric DrCCTProf</h3><p>By enabling data-centric detection in DrCCTProf, you keep track of every memory access and where it is allocated. That is, what call to malloc, is it on the stack, etc.<h2 id=deadspy><a href=#deadspy aria-label="anchor link for deadspy">##</a> DeadSpy</h2><p><a href=http://www.pace.rice.edu/uploadedFiles/Publications/deadspy.pdf>DeadSpy</a> is a tool which can help analyze <strong>dead stores</strong>. Dead stores are memory writes with no intervening reads, so there are no effects of the write. The earlier write that does nothing is called the <strong>dead write</strong> and write that replaces that write is called the <strong>killing write</strong>.<p>DeadSpy, like DrCCTProf, analyzes machine code rather than the source code. This means it is a general purpose tool that works on many different languages (that compile to machine code).<p>Dead stores are most often caused by poor data structure choice, lack of design for performance (no <code>restrict</code>, dead writes in source code, etc.), overly aggressive compile optimizations, and <strong>TODO</strong>.<p>What we care the most about here is understanding why poor machine code generation occurs. We can detect when we're being too aggressive with compiler optimizations (sometimes compiler optimizations introduce issues if they are applied in unexpected ways) or if we're being too conservative.</article>